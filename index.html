<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DABY METHOD by Teacher Daby @2025</title>
    <!-- Google Fonts for a nice sans-serif like Roboto -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS for utility classes and responsive design (loaded via CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Define CSS Variables for Burger King, McDonald's, TGIF, and Netflix Palettes */
        :root {
            /* Burger King Palette Colors */
            --bk-red: #D40026;    /* Primary Red for accents/buttons */
            --bk-gold: #F2A900;   /* Primary Golden Orange for headings/highlights */
            --bk-blue: #003366;   /* Dark Blue for specific accents/buttons */
            --bk-white: #FFFFFF;  /* White for button text/contrast */

            /* McDonald's Palette Colors (subtly integrated) */
            --mc-red: #BF0A30;    /* McDonald's Red */
            --mc-yellow: #FFC72C; /* McDonald's Yellow */

            /* TGIF Palette Colors (subtly integrated) */
            --tgif-red: #D2232A;  /* TGIF Red */
            --tgif-blue: #0070C0; /* TGIF Blue */

            /* Netflix Mode Colors (keeping for dark theme base) */
            --netflix-dark: #141414; /* Deep charcoal for background */
            --netflix-medium: #222222; /* Slightly lighter dark for cards/navbar */
            --netflix-light-text: #E5E5E5; /* Light grey for general text */

            /* Feedback colors */
            --feedback-correct: #4CAF50; /* Green for correct feedback */
            --feedback-incorrect: #FF9800; /* Orange for incorrect feedback */
        }

        /* General Body Styling - Netflix Mode */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--netflix-dark); /* Dark background */
            color: var(--netflix-light-text); /* Light text for contrast */
            margin: 0;
            padding: 0;
            line-height: 1.6;
            overflow-x: hidden; /* Prevent horizontal scroll on smaller screens */
        }

        /* Header/Navbar Styling */
        .navbar {
            background-color: var(--netflix-medium); /* Darker grey for navbar */
            padding: 15px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5); /* Subtle shadow for depth */
            position: sticky; /* Keeps navbar at the top when scrolling */
            top: 0;
            z-index: 1000; /* Ensures navbar stays on top of other content */
        }

        /* Logo Styling */
        .logo {
            color: var(--bk-red); /* Burger King Red for the logo */
            font-size: 2.2em;
            font-weight: 700;
            margin: 0; /* Remove default margin */
            animation: pulse 2s infinite alternate; /* Attention-grabbing pulse effect */
        }

        /* Keyframes for the pulse animation */
        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.02);
                opacity: 0.95;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* PDF Export Button Styling */
        .pdf-button {
            background-color: var(--bk-gold); /* Burger King Golden Orange button */
            color: var(--netflix-dark); /* Dark text for contrast on gold */
            padding: 10px 20px;
            border: none;
            border-radius: 8px; /* Rounded corners for buttons */
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease; /* Smooth transition on hover */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Add shadow for impact */
        }

        .pdf-button:hover {
            background-color: var(--mc-yellow); /* Slightly brighter gold/yellow on hover (McDonald's touch) */
            transform: translateY(-2px); /* Subtle lift effect */
        }

        /* Main Content Container - Simulates Netflix Content Grid/Flow */
        .content-container {
            display: flex;
            flex-direction: column; /* Stacks sections vertically */
            align-items: center; /* Centers content cards */
            padding: 30px 5%;
            gap: 40px; /* Space between content cards */
            max-width: 1200px; /* Max width for content for better readability */
            margin: 0 auto; /* Center the container itself */
        }

        /* Individual Content Card Styling */
        .content-card {
            background-color: var(--netflix-medium); /* Darker grey for card background */
            border-radius: 12px; /* More rounded corners for cards */
            padding: 40px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6); /* Deeper shadow for "pop" effect */
            width: 100%;
            max-width: 800px; /* Max width for individual cards */
            box-sizing: border-box; /* Include padding in width */
            transition: transform 0.4s ease, box-shadow 0.4s ease, opacity 0.6s ease;
            /* Initial state for "impact to click in sequence" */
            opacity: 0;
            transform: translateY(30px) scale(0.98); /* Start slightly below and smaller */
        }

        /* Animation class for "impact to click in sequence" */
        .content-card.fade-in {
            opacity: 1;
            transform: translateY(0) scale(1); /* Fade in and move to original position */
        }

        .content-card:hover {
            transform: translateY(-8px) scale(1.01); /* More pronounced lift on hover */
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.8); /* Stronger shadow on hover */
        }

        /* Section Title Styling - Burger King Golden Orange */
        .section-title {
            color: var(--bk-gold); /* Burger King Golden Orange for headings */
            font-size: 2.5em;
            margin-bottom: 25px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4); /* Subtle text shadow */
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px; /* Space between title and button */
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }

        /* Content Text Styling */
        .content-text {
            font-size: 1.15em;
            margin-top: 20px;
            color: var(--netflix-light-text);
            line-height: 1.8; /* Improved readability */
        }

        /* Language Buttons Container */
        .lang-buttons {
            text-align: center;
            margin-bottom: 25px;
            display: flex;
            justify-content: center;
            gap: 15px; /* Space between buttons */
        }

        /* Individual Language Button Styling */
        .lang-buttons button {
            background-color: var(--bk-red); /* Burger King Red for language buttons */
            color: var(--bk-white); /* White text for contrast */
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .lang-buttons button:hover {
            background-color: var(--tgif-red); /* Slightly brighter red on hover (TGIF touch) */
            transform: translateY(-1px);
        }

        /* Active Language Button Styling */
        .lang-buttons button.active {
            background-color: var(--bk-gold); /* Burger King Golden Orange for active button */
            color: var(--netflix-dark); /* Dark text for contrast */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }

        /* Highlight for expressions */
        .highlight-expression {
            background-color: var(--bk-gold); /* Golden Orange background */
            color: var(--netflix-dark); /* Dark text */
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold; /* Make it bold for emphasis */
            white-space: nowrap; /* Prevent breaking across lines for short phrases */
        }

        /* Exercise Specific Styles */
        .exercise-container {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .exercise-container h3 {
            color: var(--bk-gold); /* Burger King Golden Orange */
            font-size: 1.8em;
            margin-bottom: 15px;
        }

        .exercise-prompt, .matching-item {
            font-size: 1.1em;
            margin-bottom: 10px;
            color: var(--netflix-light-text);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .exercise-input, .matching-input {
            background-color: #333;
            color: var(--netflix-light-text);
            border: 1px solid #555;
            border-radius: 5px;
            padding: 10px;
            font-size: 1em;
            width: 70%;
            max-width: 300px;
            box-sizing: border-box;
        }

        .exercise-button {
            background-color: var(--bk-red); /* Burger King Red */
            color: var(--bk-white);
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-left: 10px;
        }

        .exercise-button:hover {
            background-color: var(--mc-red); /* Slightly brighter red on hover (McDonald's touch) */
            transform: translateY(-1px);
        }

        .play-audio-button {
            background-color: var(--bk-blue); /* Burger King Blue */
            color: var(--bk-white);
            padding: 8px 12px; /* Smaller padding for inline buttons */
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em; /* Smaller font size for inline buttons */
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-left: 5px; /* Small margin to separate from text */
            white-space: nowrap; /* Prevent button text from wrapping */
            display: inline-flex; /* Align icon and text */
            align-items: center;
            gap: 5px;
        }

        .play-audio-button:hover {
            background-color: var(--tgif-blue); /* Slightly darker blue on hover (TGIF touch) */
            transform: translateY(-1px);
        }

        .feedback-message {
            margin-top: 15px;
            font-weight: bold;
            font-size: 1.1em;
            min-height: 25px;
        }

        .feedback-message.correct {
            color: var(--feedback-correct);
        }

        .feedback-message.incorrect {
            color: var(--feedback-incorrect);
        }

        /* Quick References specific styles */
        .quick-references ul {
            list-style: none;
            padding: 0;
            text-align: left;
            margin-top: 20px;
        }

        .quick-references ul li {
            background-color: #333;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            font-size: 1.05em;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .quick-references ul li::before {
            content: '•';
            color: var(--bk-gold); /* Burger King Golden Orange */
            font-size: 1.5em;
            line-height: 1;
        }

        /* Hi, there! visual effect box */
        .hi-there-effect-box {
            background-color: #3a3a3a;
            border: 2px solid var(--bk-gold); /* Burger King Golden Orange border */
            border-radius: 10px;
            padding: 20px; /* Reduced padding slightly */
            margin-top: 30px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            display: flex; /* Use flexbox */
            flex-direction: column; /* Stack items vertically */
            justify-content: center; /* Center content vertically */
            align-items: center; /* Center content horizontally */
            min-height: 220px; /* Increased min-height to accommodate new button and content */
            position: relative; /* For potential absolute positioning of explanation if needed, but trying flex first */
        }

        .hi-there-effect-box .display-word {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--bk-white);
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.7);
            margin-bottom: 15px; /* Space between word and button */
        }

        .hi-there-effect-box .display-word.active {
            opacity: 1;
        }

        .hi-there-effect-box button {
            background-color: var(--bk-red);
            color: var(--netflix-dark);
            padding: 10px 20px; /* Adjusted padding */
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em; /* Adjusted font size */
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            margin-top: 10px; /* Space between button and explanation */
        }

        .hi-there-effect-box button:hover {
            background-color: var(--tgif-red);
            transform: translateY(-1px);
        }

        /* Animation for the "Show Lesson 1" button */
        @keyframes subtlePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }

        .animated-lesson-button {
            animation: subtlePulse 1.5s infinite ease-in-out;
        }

        .hi-there-explanation { /* This now holds the lesson content */
            margin-top: 15px; /* Space below button */
            font-size: 0.95em;
            color: var(--netflix-light-text);
            background-color: #444;
            padding: 0px 15px; /* Initial padding 0 to allow height transition */
            border-radius: 5px;
            text-align: left; /* Align text to the left within explanation box */
            width: 90%; /* Take up most of the width */
            max-width: 600px; /* Increased max-width */
            opacity: 0;
            height: 0;
            overflow: hidden;
            transition: opacity 0.5s ease-in-out, height 0.5s ease-in-out, padding 0.5s ease-in-out;
        }

        .hi-there-explanation.active {
            opacity: 1;
            height: auto; /* Allow height to adjust to content */
            padding: 10px 15px; /* Restore padding when active */
        }

        /* New styles for the lesson content inside the explanation box */
        .lesson-content {
            padding: 10px 0; /* Internal padding for the lesson content */
        }

        .lesson-title {
            color: var(--bk-gold);
            font-size: 1.5em;
            margin-bottom: 10px;
            text-align: center;
        }
        .lesson-section-subtitle { /* New style for sub-headings within lessons */
            color: var(--mc-yellow); /* McDonald's yellow for sub-titles */
            font-size: 1.2em;
            margin-top: 20px;
            margin-bottom: 10px;
            font-weight: bold;
            text-align: center;
        }

        .lesson-intro, .lesson-note {
            font-size: 0.95em;
            margin-bottom: 10px;
            line-height: 1.6;
            display: flex; /* Enable flex for text and button alignment */
            align-items: center; /* Vertically align text and button */
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }

        .expression-box {
            background-color: var(--bk-red); /* Strong background for the expression */
            color: var(--bk-white);
            padding: 10px 20px;
            border-radius: 8px;
            margin: 15px auto; /* Center the box */
            display: inline-block; /* Shrink to content */
            font-size: 1.4em;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            animation: bounceIn 1s ease-out; /* Animation for the expression box */
        }

        @keyframes bounceIn {
            0% { transform: scale(0.8); opacity: 0; }
            60% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }

        .expression-text {
            white-space: nowrap; /* Keep expression on one line */
        }

        .lesson-examples-title {
            color: var(--bk-gold);
            font-size: 1.1em;
            margin-top: 15px;
            margin-bottom: 5px;
        }

        .lesson-examples-list {
            list-style: none;
            padding: 0;
            margin-bottom: 15px;
        }

        .lesson-examples-list li {
            position: relative;
            padding-left: 25px; /* Space for emoji */
            margin-bottom: 8px;
            font-size: 0.9em;
            display: flex; /* Enable flex for text and button alignment */
            align-items: center; /* Vertically align text and button */
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }

        .lesson-examples-list li::before {
            content: '👉'; /* Emoji bullet */
            position: absolute;
            left: 0;
            color: var(--bk-gold); /* Golden emoji */
            font-size: 1.1em;
            line-height: 1;
        }

        .highlight-text { /* For highlighting text within paragraphs */
            color: var(--mc-yellow);
            font-weight: bold;
        }

        .translation-list, .reorder-exercise-list, .preposition-exercise-list { /* Added .preposition-exercise-list */
            list-style: none;
            padding: 0;
            margin-top: 10px;
        }

        .translation-list li, .reorder-exercise-list li, .preposition-exercise-list li { /* Added .preposition-exercise-list li */
            margin-bottom: 10px;
            font-size: 0.95em;
            display: flex; /* Use flexbox for alignment */
            flex-wrap: wrap; /* Allow wrapping on small screens */
            align-items: center;
            gap: 5px; /* Small gap between elements */
        }
        .translation-list li strong {
            flex-basis: 100%; /* Portuguese sentence takes full width */
            color: var(--bk-gold);
        }

        .reorder-prompt {
            margin-top: 15px;
            margin-bottom: 10px;
            font-weight: bold;
            color: var(--netflix-light-text);
        }

        .reorder-input, .ai-check-input, .translation-input { /* Added .translation-input */
            background-color: #333;
            color: var(--netflix-light-text);
            border: 1px solid #555;
            border-radius: 5px;
            padding: 10px;
            font-size: 1em;
            width: 70%;
            max-width: 300px;
            box-sizing: border-box;
            margin-bottom: 10px;
        }
        /* Specific width for preposition input */
        .reorder-input.w-24 {
            width: 96px; /* Tailwind's w-24 is 6rem = 96px */
            max-width: 96px;
        }
        .translation-input {
            flex-grow: 1; /* Allows textarea to take available space */
            margin-right: 10px; /* Space before button */
            height: 40px; /* Fixed height for single line */
            resize: vertical; /* Allow vertical resizing, but keep initial small */
        }
        .translation-list li button {
            margin-bottom: 10px; /* Align button with textarea */
        }


        .ai-feedback-box {
            background-color: #333;
            border: 1px solid var(--bk-blue);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            text-align: left;
            min-height: 50px;
            line-height: 1.5;
            color: var(--netflix-light-text);
        }

        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--bk-gold);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }


        /* New styles for the conversation type box */
        .conversation-type-box {
            background-color: #3a3a3a; /* Darker background for the box */
            border: 2px solid var(--bk-gold); /* Golden Orange border */
            border-radius: 10px;
            padding: 25px;
            margin-top: 30px;
            text-align: left; /* Align text to the left within the box */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            transition: transform 0.4s ease, box-shadow 0.4s ease;
            opacity: 0; /* Start hidden for fade-in effect */
            transform: translateY(20px); /* Start slightly below */
        }

        .conversation-type-box.fade-in {
            opacity: 1;
            transform: translateY(0);
        }

        .conversation-type-box h4 {
            color: var(--bk-gold); /* Golden Orange for subheadings */
            font-size: 1.4em;
            margin-top: 0;
            margin-bottom: 10px;
        }

        .conversation-type-box p {
            font-size: 1.05em;
            margin-bottom: 15px;
            color: var(--netflix-light-text);
            display: flex; /* Enable flex for text and button alignment */
            align-items: center; /* Vertically align text and button */
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }

        .conversation-type-box ul {
            list-style: none;
            padding: 0;
            margin-top: 10px;
        }

        .conversation-type-box ul li {
            position: relative; /* For absolute positioning of pseudo-element */
            padding-left: 30px; /* Space for the emoji */
            margin-bottom: 10px;
            display: flex; /* Enable flex for text and button alignment */
            align-items: center; /* Vertically align text and button */
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }

        .conversation-type-box ul li::before {
            content: '👉'; /* Emoji bullet point */
            position: absolute;
            left: 0;
            color: var(--bk-red); /* Red for the emoji */
            font-size: 1.2em;
            line-height: 1;
        }

        /* New style for the explanation box */
        .explanation-box {
            background-color: #3a3a3a;
            border: 2px solid var(--mc-yellow); /* McDonald's Yellow border for emphasis */
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
            text-align: left;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }

        .explanation-box.fade-in {
            opacity: 1;
            transform: translateY(0);
        }

        .explanation-box h4 {
            color: var(--mc-yellow);
            font-size: 1.3em;
            margin-top: 0;
            margin-bottom: 10px;
        }

        .explanation-box p {
            font-size: 0.95em;
            line-height: 1.6;
            color: var(--netflix-light-text);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Footer Styling */
        footer {
            text-align: center;
            padding: 25px;
            background-color: var(--netflix-medium);
            margin-top: 60px;
            color: var(--netflix-light-text);
            font-size: 0.9em;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Responsive Design for smaller screens */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 15px;
                padding: 15px 3%;
            }

            .logo {
                font-size: 1.8em;
            }

            .pdf-button {
                width: 100%;
                text-align: center;
            }

            .content-container {
                padding: 20px 3%;
                gap: 30px;
            }

            .content-card {
                padding: 30px;
            }

            .section-title {
                font-size: 2em;
                flex-direction: column; /* Stack title and button vertically */
                gap: 10px;
            }

            .content-text {
                font-size: 1em;
            }

            .lang-buttons {
                flex-direction: column;
                gap: 10px;
            }

            .lang-buttons button {
                width: 80%;
                margin: 0 auto;
            }

            .hi-there-effect-box {
                min-height: 800px; /* Adjusted for smaller screens to fit all lesson content */
            }

            .hi-there-effect-box .display-word {
                font-size: 1.4em;
            }

            .hi-there-effect-box button {
                margin-top: 10px; /* Adjusted margin */
            }

            .exercise-input {
                width: 90%;
            }

            .expression-box {
                font-size: 1.2em;
                padding: 8px 15px;
            }
            .hi-there-explanation {
                max-width: 90%; /* Adjusted for smaller screens */
            }
            .translation-list li {
                flex-direction: column; /* Stack items vertically on small screens */
                align-items: flex-start; /* Align text to the left */
            }
            .translation-input {
                width: 100%; /* Full width for input on small screens */
                margin-right: 0;
            }
            .translation-list li button {
                width: 100%; /* Full width for button on small screens */
                margin-left: 0;
            }
            .play-audio-button {
                margin-top: 5px; /* Add some space if it wraps */
            }
        }
    </style>
</head>
<body>
    <!-- Navbar Section -->
    <header class="navbar">
        <h1 class="logo">DABY METHOD</h1>
        <button id="exportPdfBtn" class="pdf-button">Export Lesson to PDF</button>
    </header>

    <!-- Main Content Container -->
    <main class="content-container">

        <!-- Section 1: Welcome & Hi, There! Effect -->
        <section id="section-welcome" class="content-card">
            <div class="lang-buttons">
                <button class="lang-btn active" data-lang="en" data-section="section-welcome">English</button>
                <button class="lang-btn" data-lang="pt" data-section="section-welcome">Português</button>
            </div>
            <div class="content-en">
                <h2 class="section-title">
                    Lesson 1: Where do you work? 🏢
                </h2>
                <div class="lesson-content">
                    <p class="lesson-intro" id="lesson1-intro-en">
                        Let's learn how to talk about your workplace! The most common way to say where you work is using <span class="highlight-text">"I work at..."</span>
                        This phrase is used for specific companies, organizations, or physical locations.
                        <button class="play-audio-button" data-text="Let's learn how to talk about your workplace! The most common way to say where you work is using I work at... This phrase is used for specific companies, organizations, or physical locations.">▶️ Play Audio</button>
                        <span id="lesson1-intro-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <p><strong>Formula to remember:</strong></p>
                    <div class="expression-box">
                        <span class="expression-text">I work at...</span> ✨
                        <button class="play-audio-button" data-text="I work at...">▶️ Play Audio</button>
                        <span id="expression-box-en-spinner" class="loading-spinner hidden"></span>
                    </div>
                    <p class="lesson-examples-title">Examples:</p>
                    <ul class="lesson-examples-list">
                        <li>👉 <span class="highlight-expression">I work at Google</span>. 💻
                            <button class="play-audio-button" data-text="I work at Google.">▶️ Play Audio</button>
                            <span id="example1-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">She works at a hospital</span>. 🏥
                            <button class="play-audio-button" data-text="She works at a hospital.">▶️ Play Audio</button>
                            <span id="example2-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">We work at the local school</span>. 🏫
                            <button class="play-audio-button" data-text="We work at the local school.">▶️ Play Audio</button>
                            <span id="example3-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                    </ul>
                    <p class="lesson-note">
                        Remember: Use <span class="highlight-text">"at"</span> for the specific place or company.
                        <button class="play-audio-button" data-text="Remember: Use at for the specific place or company.">▶️ Play Audio</button>
                        <span id="lesson1-note-en-spinner" class="loading-spinner hidden"></span>
                    </p>

                    <h5 class="lesson-section-subtitle">Translate these sentences: 🗣️</h5>
                    <ul class="translation-list">
                        <li><strong>Português:</strong> Eu trabalho na fábrica.
                            <button class="play-audio-button" data-text="Eu trabalho na fábrica.">▶️ Play Audio</button>
                            <span id="translate-pt-1-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-en-1" class="translation-input" rows="1" placeholder="Your English translation"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-en-1', 'translate-feedback-en-1', 'Eu trabalho na fábrica.', 'en')">Check Answer</button>
                            <div id="translate-feedback-en-1" class="ai-feedback-box"></div>
                        </li>
                        <li><strong>Português:</strong> Ele trabalha na loja.
                            <button class="play-audio-button" data-text="Ele trabalha na loja.">▶️ Play Audio</button>
                            <span id="translate-pt-2-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-en-2" class="translation-input" rows="1" placeholder="Your English translation"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-en-2', 'translate-feedback-en-2', 'Ele trabalha na loja.', 'en')">Check Answer</button>
                            <div id="translate-feedback-en-2" class="ai-feedback-box"></div>
                        </li>
                        <li><strong>Português:</strong> Nós trabalhamos na escola.
                            <button class="play-audio-button" data-text="Nós trabalhamos na escola.">▶️ Play Audio</button>
                            <span id="translate-pt-3-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-en-3" class="translation-input" rows="1" placeholder="Your English translation"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-en-3', 'translate-feedback-en-3', 'Nós trabalhamos na escola.', 'en')">Check Answer</button>
                            <div id="translate-feedback-en-3" class="ai-feedback-box"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Exercise: Reorder the words! 🧩</h5>
                    <p class="reorder-prompt">Type the correct sentence:
                        <button class="play-audio-button" data-text="Type the correct sentence.">▶️ Play Audio</button>
                        <span id="reorder-prompt-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <ul class="reorder-exercise-list">
                        <li>1. at / I / a / work / bank.
                            <button class="play-audio-button" data-text="at I a work bank.">▶️ Play Audio</button>
                            <span id="reorder-ex1-en-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-en-1" class="reorder-input" placeholder="Your answer">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-en-1', 'I work at a bank.', 'reorder-feedback-en-1')">Check Answer</button>
                            <div id="reorder-feedback-en-1" class="feedback-message"></div>
                        </li>
                        <li>2. office / the / works / at / He.
                            <button class="play-audio-button" data-text="office the works at He.">▶️ Play Audio</button>
                            <span id="reorder-ex2-en-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-en-2" class="reorder-input" placeholder="Your answer">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-en-2', 'He works at the office.', 'reorder-feedback-en-2')">Check Answer</button>
                            <div id="reorder-feedback-en-2" class="feedback-message"></div>
                        </li>
                        <li>3. together / work / We.
                            <button class="play-audio-button" data-text="together work We.">▶️ Play Audio</button>
                            <span id="reorder-ex3-en-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-en-3" class="reorder-input" placeholder="Your answer">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-en-3', 'We work together.', 'reorder-feedback-en-3')">Check Answer</button>
                            <div id="reorder-feedback-en-3" class="feedback-message"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Exercise: Complete with 'at' or 'in'! 📝</h5>
                    <p class="reorder-prompt">Choose the correct preposition:
                        <button class="play-audio-button" data-text="Choose the correct preposition.">▶️ Play Audio</button>
                        <span id="preposition-prompt-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <ul class="preposition-exercise-list">
                        <li>1. I work <input type="text" id="preposition-input-en-1" class="reorder-input w-24" placeholder="at/in"> a big company.
                            <button class="play-audio-button" data-text="I work a big company.">▶️ Play Audio</button>
                            <span id="preposition-ex1-en-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-welcome', 'preposition-input-en-1', 'preposition-feedback-en-1', 'at')">Check Answer</button>
                            <div id="preposition-feedback-en-1" class="feedback-message"></div>
                        </li>
                        <li>2. She works <input type="text" id="preposition-input-en-2" class="reorder-input w-24" placeholder="at/in"> the city center.
                            <button class="play-audio-button" data-text="She works the city center.">▶️ Play Audio</button>
                            <span id="preposition-ex2-en-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-welcome', 'preposition-input-en-2', 'preposition-feedback-en-2', 'in')">Check Answer</button>
                            <div id="preposition-feedback-en-2" class="feedback-message"></div>
                        </li>
                        <li>3. They work <input type="text" id="preposition-input-en-3" class="reorder-input w-24" placeholder="at/in"> a restaurant.
                            <button class="play-audio-button" data-text="They work a restaurant.">▶️ Play Audio</button>
                            <span id="preposition-ex3-en-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-welcome', 'preposition-input-en-3', 'preposition-feedback-en-3', 'at')">Check Answer</button>
                            <div id="preposition-feedback-en-3" class="feedback-message"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Ask the AI: Where do you work? 🤖</h5>
                    <p class="reorder-prompt">Tell us where you work, or make up a sentence! The AI will give you feedback.
                        <button class="play-audio-button" data-text="Tell us where you work, or make up a sentence! The AI will give you feedback.">▶️ Play Audio</button>
                        <span id="ai-prompt-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <textarea id="ai-check-input-en" class="ai-check-input" rows="3" placeholder="Example: I work at a tech company."></textarea>
                    <button class="exercise-button" onclick="checkWithAI('ai-check-input-en', 'ai-feedback-en', 'Where do you work?')">Check Answer</button>
                    <div id="ai-feedback-en" class="ai-feedback-box"></div>
                </div>
            </div>
            <div class="content-pt hidden">
                <h2 class="section-title">
                    Lição 1: Onde você trabalha? 🏢
                </h2>
                <div class="lesson-content">
                    <p class="lesson-intro" id="lesson1-intro-pt">
                        Vamos aprender a falar sobre seu local de trabalho! A forma mais comum de dizer onde você trabalha é usando <span class="highlight-text">"Eu trabalho na..."</span>
                        Essa frase é usada para empresas específicas, organizações ou locais físicos.
                        <button class="play-audio-button" data-text="Vamos aprender a falar sobre seu local de trabalho! A forma mais comum de dizer onde você trabalha é usando Eu trabalho na... Essa frase é usada para empresas específicas, organizações ou locais físicos.">▶️ Reproduzir Áudio</button>
                        <span id="lesson1-intro-pt-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <p><strong>Fórmula para lembrar:</strong></p>
                    <div class="expression-box">
                        <span class="expression-text">Eu trabalho na...</span> ✨
                        <button class="play-audio-button" data-text="Eu trabalho na...">▶️ Reproduzir Áudio</button>
                        <span id="expression-box-pt-spinner" class="loading-spinner hidden"></span>
                    </div>
                    <p class="lesson-examples-title">Exemplos:</p>
                    <ul class="lesson-examples-list">
                        <li>👉 <span class="highlight-expression">Eu trabalho na Google</span>. 💻
                            <button class="play-audio-button" data-text="Eu trabalho na Google.">▶️ Reproduzir Áudio</button>
                            <span id="example1-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Ela trabalha em um hospital</span>. 🏥
                            <button class="play-audio-button" data-text="Ela trabalha em um hospital.">▶️ Reproduzir Áudio</button>
                            <span id="example2-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Nós trabalhamos na escola local</span>. 🏫
                            <button class="play-audio-button" data-text="Nós trabalhamos na escola local.">▶️ Reproduzir Áudio</button>
                            <span id="example3-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                    </ul>
                    <p class="lesson-note">
                        Lembre-se: Use <span class="highlight-text">"na"</span> (ou "no", "em") para o local ou empresa específica.
                        <button class="play-audio-button" data-text="Lembre-se: Use na, ou no, ou em, para o local ou empresa específica.">▶️ Reproduzir Áudio</button>
                        <span id="lesson1-note-pt-spinner" class="loading-spinner hidden"></span>
                    </p>

                    <h5 class="lesson-section-subtitle">Traduza estas frases: 🗣️</h5>
                    <ul class="translation-list">
                        <li><strong>Português:</strong> Eu trabalho em casa.
                            <button class="play-audio-button" data-text="Eu trabalho em casa.">▶️ Reproduzir Áudio</button>
                            <span id="translate-pt-1-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-pt-1" class="translation-input" rows="1" placeholder="Sua tradução para o inglês"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-pt-1', 'translate-feedback-pt-1', 'Eu trabalho em casa.', 'pt')">Check Answer</button>
                            <div id="translate-feedback-pt-1" class="ai-feedback-box"></div>
                        </li>
                        <li><strong>Português:</strong> Ele trabalha no escritório.
                            <button class="play-audio-button" data-text="Ele trabalha no escritório.">▶️ Reproduzir Áudio</button>
                            <span id="translate-pt-2-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-pt-2" class="translation-input" rows="1" placeholder="Sua tradução para o inglês"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-pt-2', 'translate-feedback-pt-2', 'Ele trabalha no escritório.', 'pt')">Check Answer</button>
                            <div id="translate-feedback-pt-2" class="ai-feedback-box"></div>
                        </li>
                        <li><strong>Português:</strong> Nós trabalhamos juntos.
                            <button class="play-audio-button" data-text="Nós trabalhamos juntos.">▶️ Reproduzir Áudio</button>
                            <span id="translate-pt-3-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-pt-3" class="translation-input" rows="1" placeholder="Sua tradução para o inglês"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-pt-3', 'translate-feedback-pt-3', 'Nós trabalhamos juntos.', 'pt')">Check Answer</button>
                            <div id="translate-feedback-pt-3" class="ai-feedback-box"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Exercício: Reordene as palavras! 🧩</h5>
                    <p class="reorder-prompt">Digite a frase correta:
                        <button class="play-audio-button" data-text="Digite a frase correta.">▶️ Reproduzir Áudio</button>
                        <span id="reorder-prompt-pt-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <ul class="reorder-exercise-list">
                        <li>1. na / Eu / trabalho / escola.
                            <button class="play-audio-button" data-text="na Eu trabalho escola.">▶️ Reproduzir Áudio</button>
                            <span id="reorder-ex1-pt-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-pt-1" class="reorder-input" placeholder="Sua resposta">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-pt-1', 'Eu trabalho na escola.', 'reorder-feedback-pt-1')">Check Answer</button>
                            <div id="reorder-feedback-pt-1" class="feedback-message"></div>
                        </li>
                        <li>2. em / Ele / casa / trabalha.
                            <button class="play-audio-button" data-text="em Ele casa trabalha.">▶️ Reproduzir Áudio</button>
                            <span id="reorder-ex2-pt-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-pt-2" class="reorder-input" placeholder="Sua resposta">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-pt-2', 'Ele trabalha em casa.', 'reorder-feedback-pt-2')">Check Answer</button>
                            <div id="reorder-feedback-pt-2" class="feedback-message"></div>
                        </li>
                        <li>3. juntos / Nós / trabalhamos.
                            <button class="play-audio-button" data-text="juntos Nós trabalhamos.">▶️ Reproduzir Áudio</button>
                            <span id="reorder-ex3-pt-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-pt-3" class="reorder-input" placeholder="Sua resposta">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-pt-3', 'Nós trabalhamos juntos.', 'reorder-feedback-pt-3')">Check Answer</button>
                            <div id="reorder-feedback-pt-3" class="feedback-message"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Exercício: Complete com 'at' ou 'in'! 📝</h5>
                    <p class="reorder-prompt">Escolha a preposição correta:
                        <button class="play-audio-button" data-text="Escolha a preposição correta.">▶️ Reproduzir Áudio</button>
                        <span id="preposition-prompt-pt-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <ul class="preposition-exercise-list">
                        <li>1. Eu trabalho <input type="text" id="preposition-input-pt-1" class="reorder-input w-24" placeholder="at/in"> uma grande empresa.
                            <button class="play-audio-button" data-text="Eu trabalho uma grande empresa.">▶️ Reproduzir Áudio</button>
                            <span id="preposition-ex1-pt-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-welcome', 'preposition-input-pt-1', 'preposition-feedback-pt-1', 'at')">Check Answer</button>
                            <div id="preposition-feedback-pt-1" class="feedback-message"></div>
                        </li>
                        <li>2. Ela trabalha <input type="text" id="preposition-input-pt-2" class="reorder-input w-24" placeholder="at/in"> no centro da cidade.
                            <button class="play-audio-button" data-text="Ela trabalha no centro da cidade.">▶️ Reproduzir Áudio</button>
                            <span id="preposition-ex2-pt-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-welcome', 'preposition-input-pt-2', 'preposition-feedback-pt-2', 'in')">Check Answer</button>
                            <div id="preposition-feedback-pt-2" class="feedback-message"></div>
                        </li>
                        <li>3. Eles trabalham <input type="text" id="preposition-input-pt-3" class="reorder-input w-24" placeholder="at/in"> em um restaurante.
                            <button class="play-audio-button" data-text="Eles trabalham em um restaurante.">▶️ Reproduzir Áudio</button>
                            <span id="preposition-ex3-pt-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-welcome', 'preposition-input-pt-3', 'preposition-feedback-pt-3', 'at')">Check Answer</button>
                            <div id="preposition-feedback-pt-3" class="ai-feedback-box"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Pergunte à IA: Onde você trabalha? 🤖</h5>
                    <p class="reorder-prompt">Diga-nos onde você trabalha, ou invente uma frase! A IA lhe dará feedback.
                        <button class="play-audio-button" data-text="Diga-nos onde você trabalha, ou invente uma frase! A IA lhe dará feedback.">▶️ Reproduzir Áudio</button>
                        <span id="ai-prompt-pt-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <textarea id="ai-check-input-pt" class="ai-check-input" rows="3" placeholder="Exemplo: Eu trabalho em uma empresa de tecnologia."></textarea>
                    <button class="exercise-button" onclick="checkWithAI('ai-check-input-pt', 'ai-feedback-pt', 'Onde você trabalha?')">Check Answer</button>
                    <div id="ai-feedback-pt" class="ai-feedback-box"></div>
                </div>
            </div>
        </section>

        <!-- New Section 2: What department do you work in? -->
        <section id="section-department" class="content-card">
            <div class="lang-buttons">
                <button class="lang-btn active" data-lang="en" data-section="section-department">English</button>
                <button class="lang-btn" data-lang="pt" data-section="section-department">Português</button>
            </div>
            <div class="content-en">
                <h2 class="section-title">
                    Lesson 2: What department do you work in? 📊
                </h2>
                <div class="lesson-content">
                    <p class="lesson-intro" id="lesson2-intro-en">
                        When talking about the specific <span class="highlight-text">area</span> or <span class="highlight-text">department</span> within a company, we use the preposition <span class="highlight-text">"in"</span>. This helps clarify your role within a larger organization.
                        <button class="play-audio-button" data-text="When talking about the specific area or department within a company, we use the preposition in. This helps clarify your role within a larger organization.">▶️ Play Audio</button>
                        <span id="lesson2-intro-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <p><strong>Formula to remember:</strong></p>
                    <div class="expression-box">
                        <span class="expression-text">I work in...</span> ✨
                        <button class="play-audio-button" data-text="I work in...">▶️ Play Audio</button>
                        <span id="expression-box-dept-en-spinner" class="loading-spinner hidden"></span>
                    </div>
                    <p class="lesson-examples-title">Examples:</p>
                    <ul class="lesson-examples-list">
                        <li>👉 <span class="highlight-expression">I work in marketing</span>. 📈
                            <button class="play-audio-button" data-text="I work in marketing.">▶️ Play Audio</button>
                            <span id="dept-example1-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">She works in Human Resources</span> (HR). 🧑‍🤝‍🧑
                            <button class="play-audio-button" data-text="She works in Human Resources.">▶️ Play Audio</button>
                            <span id="dept-example2-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">They work in the finance department</span>. 💰
                            <button class="play-audio-button" data-text="They work in the finance department.">▶️ Play Audio</button>
                            <span id="dept-example3-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                    </ul>
                    <p class="lesson-note">
                        Remember: Use <span class="highlight-text">"in"</span> for departments, fields, or general areas within a company.
                        <button class="play-audio-button" data-text="Remember: Use in for departments, fields, or general areas within a company.">▶️ Play Audio</button>
                        <span id="lesson2-note-en-spinner" class="loading-spinner hidden"></span>
                    </p>

                    <h5 class="lesson-section-subtitle">Translate these sentences: 🗣️</h5>
                    <ul class="translation-list">
                        <li><strong>Português:</strong> Eu trabalho no departamento de vendas.
                            <button class="play-audio-button" data-text="Eu trabalho no departamento de vendas.">▶️ Play Audio</button>
                            <span id="translate-dept-pt-1-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-dept-en-1" class="translation-input" rows="1" placeholder="Your English translation"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-dept-en-1', 'translate-feedback-dept-en-1', 'Eu trabalho no departamento de vendas.', 'en')">Check Answer</button>
                            <div id="translate-feedback-dept-en-1" class="ai-feedback-box"></div>
                        </li>
                        <li><strong>Português:</strong> Ele trabalha na área de TI.
                            <button class="play-audio-button" data-text="Ele trabalha na área de TI.">▶️ Play Audio</button>
                            <span id="translate-dept-pt-2-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-dept-en-2" class="translation-input" rows="1" placeholder="Your English translation"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-dept-en-2', 'translate-feedback-dept-en-2', 'Ele trabalha na área de TI.', 'en')">Check Answer</button>
                            <div id="translate-feedback-dept-en-2" class="ai-feedback-box"></div>
                        </li>
                        <li><strong>Português:</strong> Ela trabalha em marketing.
                            <button class="play-audio-button" data-text="Ela trabalha em marketing.">▶️ Play Audio</button>
                            <span id="translate-dept-pt-3-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-dept-en-3" class="translation-input" rows="1" placeholder="Your English translation"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-dept-en-3', 'translate-feedback-dept-en-3', 'Ela trabalha em marketing.', 'en')">Check Answer</button>
                            <div id="translate-feedback-dept-en-3" class="ai-feedback-box"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Exercise: Reorder the words! 🧩</h5>
                    <p class="reorder-prompt">Type the correct sentence:
                        <button class="play-audio-button" data-text="Type the correct sentence.">▶️ Play Audio</button>
                        <span id="reorder-dept-prompt-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <ul class="reorder-exercise-list">
                        <li>1. in / I / marketing / work.
                            <button class="play-audio-button" data-text="in I marketing work.">▶️ Play Audio</button>
                            <span id="reorder-dept-ex1-en-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-dept-en-1" class="reorder-input" placeholder="Your answer">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-dept-en-1', 'I work in marketing.', 'reorder-feedback-dept-en-1')">Check Answer</button>
                            <div id="reorder-feedback-dept-en-1" class="feedback-message"></div>
                        </li>
                        <li>2. HR / works / in / She.
                            <button class="play-audio-button" data-text="HR works in She.">▶️ Play Audio</button>
                            <span id="reorder-dept-ex2-en-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-dept-en-2" class="reorder-input" placeholder="Your answer">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-dept-en-2', 'She works in HR.', 'reorder-feedback-dept-en-2')">Check Answer</button>
                            <div id="reorder-feedback-dept-en-2" class="feedback-message"></div>
                        </li>
                        <li>3. department / They / the / work / in / finance.
                            <button class="play-audio-button" data-text="department They the work in finance.">▶️ Play Audio</button>
                            <span id="reorder-dept-ex3-en-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-dept-en-3" class="reorder-input" placeholder="Your answer">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-dept-en-3', 'They work in the finance department.', 'reorder-feedback-dept-en-3')">Check Answer</button>
                            <div id="reorder-feedback-dept-en-3" class="feedback-message"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Exercise: Complete with 'at' or 'in'! 📝</h5>
                    <p class="reorder-prompt">Choose the correct preposition:
                        <button class="play-audio-button" data-text="Choose the correct preposition.">▶️ Play Audio</button>
                        <span id="preposition-dept-prompt-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <ul class="preposition-exercise-list">
                        <li>1. I work <input type="text" id="preposition-input-dept-en-1" class="reorder-input w-24" placeholder="at/in"> sales.
                            <button class="play-audio-button" data-text="I work sales.">▶️ Play Audio</button>
                            <span id="preposition-dept-ex1-en-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-department', 'preposition-input-dept-en-1', 'preposition-feedback-dept-en-1', 'in')">Check Answer</button>
                            <div id="preposition-feedback-dept-en-1" class="feedback-message"></div>
                        </li>
                        <li>2. She works <input type="text" id="preposition-input-dept-en-2" class="reorder-input w-24" placeholder="at/in"> human resources.
                            <button class="play-audio-button" data-text="She works human resources.">▶️ Play Audio</button>
                            <span id="preposition-dept-ex2-en-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-department', 'preposition-input-dept-en-2', 'preposition-feedback-dept-en-2', 'in')">Check Answer</button>
                            <div id="preposition-feedback-dept-en-2" class="feedback-message"></div>
                        </li>
                        <li>3. He works <input type="text" id="preposition-input-dept-en-3" class="reorder-input w-24" placeholder="at/in"> the IT department.
                            <button class="play-audio-button" data-text="He works the IT department.">▶️ Play Audio</button>
                            <span id="preposition-dept-ex3-en-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-department', 'preposition-input-dept-en-3', 'preposition-feedback-dept-en-3', 'in')">Check Answer</button>
                            <div id="preposition-feedback-dept-en-3" class="ai-feedback-box"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Pergunte à IA: Em qual departamento você trabalha? 🤖</h5>
                    <p class="reorder-prompt">Tell us what department you work in, or make up a sentence! The AI will give you feedback.
                        <button class="play-audio-button" data-text="Tell us what department you work in, or make up a sentence! The AI will give you feedback.">▶️ Play Audio</button>
                        <span id="ai-dept-prompt-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <textarea id="ai-check-input-dept-en" class="ai-check-input" rows="3" placeholder="Example: I work in the marketing department."></textarea>
                    <button class="exercise-button" onclick="checkWithAI('ai-check-input-dept-en', 'ai-feedback-dept-en', 'What department do you work in?')">Check Answer</button>
                    <div id="ai-feedback-dept-en" class="ai-feedback-box"></div>
                </div>
            </div>
            <div class="content-pt hidden">
                <h2 class="section-title">
                    Lição 2: Em qual departamento você trabalha? 📊
                </h2>
                <div class="lesson-content">
                    <p class="lesson-intro" id="lesson2-intro-pt">
                        Ao falar sobre a <span class="highlight-text">área</span> ou <span class="highlight-text">departamento</span> específico dentro de uma empresa, usamos a preposição <span class="highlight-text">"em"</span> (ou "no", "na"). Isso ajuda a esclarecer seu papel dentro de uma organização maior.
                        <button class="play-audio-button" data-text="Ao falar sobre a área ou departamento específico dentro de uma empresa, usamos a preposição em, ou no, ou na. Isso ajuda a esclarecer seu papel dentro de uma organização maior.">▶️ Reproduzir Áudio</button>
                        <span id="lesson2-intro-pt-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <p><strong>Fórmula para lembrar:</strong></p>
                    <div class="expression-box">
                        <span class="expression-text">Eu trabalho em...</span> ✨
                        <button class="play-audio-button" data-text="Eu trabalho em...">▶️ Reproduzir Áudio</button>
                        <span id="expression-box-dept-pt-spinner" class="loading-spinner hidden"></span>
                    </div>
                    <p class="lesson-examples-title">Exemplos:</p>
                    <ul class="lesson-examples-list">
                        <li>👉 <span class="highlight-expression">Eu trabalho em marketing</span>. 📈
                            <button class="play-audio-button" data-text="Eu trabalho em marketing.">▶️ Reproduzir Áudio</button>
                            <span id="dept-example1-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Ela trabalha em Recursos Humanos</span> (RH). 🧑‍🤝‍🧑
                            <button class="play-audio-button" data-text="Ela trabalha em Recursos Humanos.">▶️ Reproduzir Áudio</button>
                            <span id="dept-example2-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Eles trabalham no departamento financeiro</span>. 💰
                            <button class="play-audio-button" data-text="Eles trabalham no departamento financeiro.">▶️ Reproduzir Áudio</button>
                            <span id="dept-example3-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                    </ul>
                    <p class="lesson-note">
                        Lembre-se: Use <span class="highlight-text">"em"</span> (ou "no", "na") para departamentos, áreas ou campos gerais dentro de uma empresa.
                        <button class="play-audio-button" data-text="Lembre-se: Use em, ou no, ou na, para departamentos, áreas ou campos gerais dentro de uma empresa.">▶️ Reproduzir Áudio</button>
                        <span id="lesson2-note-pt-spinner" class="loading-spinner hidden"></span>
                    </p>

                    <h5 class="lesson-section-subtitle">Traduza estas frases: 🗣️</h5>
                    <ul class="translation-list">
                        <li><strong>Português:</strong> Eu trabalho no departamento de vendas.
                            <button class="play-audio-button" data-text="Eu trabalho no departamento de vendas.">▶️ Reproduzir Áudio</button>
                            <span id="translate-dept-pt-1-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-dept-pt-1" class="translation-input" rows="1" placeholder="Sua tradução para o inglês"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-dept-pt-1', 'translate-feedback-dept-pt-1', 'Eu trabalho no departamento de vendas.', 'pt')">Check Answer</button>
                            <div id="translate-feedback-dept-pt-1" class="ai-feedback-box"></div>
                        </li>
                        <li><strong>Português:</strong> Ele trabalha na área de TI.
                            <button class="play-audio-button" data-text="Ele trabalha na área de TI.">▶️ Reproduzir Áudio</button>
                            <span id="translate-dept-pt-2-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-dept-pt-2" class="translation-input" rows="1" placeholder="Sua tradução para o inglês"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-dept-pt-2', 'translate-feedback-dept-pt-2', 'Ele trabalha na área de TI.', 'pt')">Check Answer</button>
                            <div id="translate-feedback-dept-pt-2" class="ai-feedback-box"></div>
                        </li>
                        <li><strong>Português:</strong> Ela trabalha em marketing.
                            <button class="play-audio-button" data-text="Ela trabalha em marketing.">▶️ Reproduzir Áudio</button>
                            <span id="translate-dept-pt-3-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-dept-pt-3" class="translation-input" rows="1" placeholder="Sua tradução para o inglês"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-dept-pt-3', 'translate-feedback-dept-pt-3', 'Ela trabalha em marketing.', 'pt')">Check Answer</button>
                            <div id="translate-feedback-dept-pt-3" class="ai-feedback-box"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Exercício: Reordene as palavras! 🧩</h5>
                    <p class="reorder-prompt">Digite a frase correta:
                        <button class="play-audio-button" data-text="Digite a frase correta.">▶️ Reproduzir Áudio</button>
                        <span id="reorder-dept-prompt-pt-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <ul class="reorder-exercise-list">
                        <li>1. em / Eu / marketing / trabalho.
                            <button class="play-audio-button" data-text="em Eu marketing trabalho.">▶️ Reproduzir Áudio</button>
                            <span id="reorder-dept-ex1-pt-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-dept-pt-1" class="reorder-input" placeholder="Sua resposta">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-dept-pt-1', 'Eu trabalho em marketing.', 'reorder-feedback-dept-pt-1')">Check Answer</button>
                            <div id="reorder-feedback-dept-pt-1" class="feedback-message"></div>
                        </li>
                        <li>2. RH / trabalha / em / Ela.
                            <button class="play-audio-button" data-text="RH trabalha em Ela.">▶️ Reproduzir Áudio</button>
                            <span id="reorder-dept-ex2-pt-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-dept-pt-2" class="reorder-input" placeholder="Sua resposta">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-dept-pt-2', 'Ela trabalha em RH.', 'reorder-feedback-dept-pt-2')">Check Answer</button>
                            <div id="reorder-feedback-dept-pt-2" class="feedback-message"></div>
                        </li>
                        <li>3. financeiro / Eles / no / trabalham / departamento.
                            <button class="play-audio-button" data-text="financeiro Eles no trabalham departamento.">▶️ Reproduzir Áudio</button>
                            <span id="reorder-dept-ex3-pt-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-dept-pt-3" class="reorder-input" placeholder="Sua resposta">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-dept-pt-3', 'Eles trabalham no departamento financeiro.', 'reorder-feedback-dept-pt-3')">Check Answer</button>
                            <div id="reorder-feedback-dept-pt-3" class="feedback-message"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Exercício: Complete com 'at' ou 'in'! 📝</h5>
                    <p class="reorder-prompt">Escolha a preposição correta:
                        <button class="play-audio-button" data-text="Escolha a preposição correta.">▶️ Reproduzir Áudio</button>
                        <span id="preposition-dept-prompt-pt-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <ul class="preposition-exercise-list">
                        <li>1. Eu trabalho <input type="text" id="preposition-input-dept-pt-1" class="reorder-input w-24" placeholder="at/in"> vendas.
                            <button class="play-audio-button" data-text="Eu trabalho vendas.">▶️ Reproduzir Áudio</button>
                            <span id="preposition-dept-ex1-pt-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-department', 'preposition-input-dept-pt-1', 'preposition-feedback-dept-pt-1', 'in')">Check Answer</button>
                            <div id="preposition-feedback-dept-pt-1" class="feedback-message"></div>
                        </li>
                        <li>2. Ela trabalha <input type="text" id="preposition-input-dept-pt-2" class="reorder-input w-24" placeholder="at/in"> recursos humanos.
                            <button class="play-audio-button" data-text="Ela trabalha recursos humanos.">▶️ Reproduzir Áudio</button>
                            <span id="preposition-dept-ex2-pt-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-department', 'preposition-input-dept-pt-2', 'preposition-feedback-dept-pt-2', 'in')">Check Answer</button>
                            <div id="preposition-feedback-dept-pt-2" class="feedback-message"></div>
                        </li>
                        <li>3. Ele trabalha <input type="text" id="preposition-input-dept-pt-3" class="reorder-input w-24" placeholder="at/in"> o departamento de TI.
                            <button class="play-audio-button" data-text="Ele trabalha o departamento de TI.">▶️ Reproduzir Áudio</button>
                            <span id="preposition-dept-ex3-pt-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-department', 'preposition-input-dept-pt-3', 'preposition-feedback-dept-pt-3', 'in')">Check Answer</button>
                            <div id="preposition-feedback-dept-pt-3" class="ai-feedback-box"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Pergunte à IA: Em qual departamento você trabalha? 🤖</h5>
                    <p class="reorder-prompt">Diga-nos em qual departamento você trabalha, ou invente uma frase! A IA lhe dará feedback.
                        <button class="play-audio-button" data-text="Diga-nos em qual departamento você trabalha, ou invente uma frase! A IA lhe dará feedback.">▶️ Reproduzir Áudio</button>
                        <span id="ai-dept-prompt-pt-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <textarea id="ai-check-input-dept-pt" class="ai-check-input" rows="3" placeholder="Exemplo: Eu trabalho no departamento de marketing."></textarea>
                    <button class="exercise-button" onclick="checkWithAI('ai-check-input-dept-pt', 'ai-feedback-dept-pt', 'Em qual departamento você trabalha?')">Check Answer</button>
                    <div id="ai-feedback-dept-pt" class="ai-feedback-box"></div>
                </div>
            </div>
        </section>

        <!-- New Section 3: Work from Home and Work In-Person -->
        <section id="section-work-location" class="content-card">
            <div class="lang-buttons">
                <button class="lang-btn active" data-lang="en" data-section="section-work-location">English</button>
                <button class="lang-btn" data-lang="pt" data-section="section-work-location">Português</button>
            </div>
            <div class="content-en">
                <h2 class="section-title">
                    Lesson 3: Work from Home / In-Person 🏠🏢
                </h2>
                <div class="lesson-content">
                    <p class="lesson-intro" id="lesson3-intro-en">
                        In today's world, it's common to talk about where you physically work. We use specific phrases to describe if you work remotely or at a physical location.
                        <button class="play-audio-button" data-text="In today's world, it's common to talk about where you physically work. We use specific phrases to describe if you work remotely or at a physical location.">▶️ Play Audio</button>
                        <span id="lesson3-intro-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <p><strong>Formulas to remember:</strong></p>
                    <div class="expression-box">
                        <span class="expression-text">I work from home.</span> ✨
                        <button class="play-audio-button" data-text="I work from home.">▶️ Play Audio</button>
                        <span id="expression-box-home-en-spinner" class="loading-spinner hidden"></span>
                    </div>
                    <div class="expression-box mt-4">
                        <span class="expression-text">I work in-person.</span> ✨
                        <button class="play-audio-button" data-text="I work in-person.">▶️ Play Audio</button>
                        <span id="expression-box-inperson-en-spinner" class="loading-spinner hidden"></span>
                    </div>
                    <p class="lesson-examples-title">Examples:</p>
                    <ul class="lesson-examples-list">
                        <li>👉 <span class="highlight-expression">I work from home</span> on Mondays and Fridays. 🏡
                            <button class="play-audio-button" data-text="I work from home on Mondays and Fridays.">▶️ Play Audio</button>
                            <span id="location-example1-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">She works in-person</span> at the main office. 🏢
                            <button class="play-audio-button" data-text="She works in-person at the main office.">▶️ Play Audio</button>
                            <span id="location-example2-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 Due to the pandemic, many people <span class="highlight-expression">work from home</span>. 💻
                            <button class="play-audio-button" data-text="Due to the pandemic, many people work from home.">▶️ Play Audio</button>
                            <span id="location-example3-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 He prefers to <span class="highlight-expression">work in-person</span> for better collaboration. 🤝
                            <button class="play-audio-button" data-text="He prefers to work in-person for better collaboration.">▶️ Play Audio</button>
                            <span id="location-example4-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                    </ul>
                    <p class="lesson-note">
                        Remember: <span class="highlight-text">"from home"</span> indicates remote work, while <span class="highlight-text">"in-person"</span> indicates working at a physical location.
                        <button class="play-audio-button" data-text="Remember: from home indicates remote work, while in-person indicates working at a physical location.">▶️ Play Audio</button>
                        <span id="lesson3-note-en-spinner" class="loading-spinner hidden"></span>
                    </p>

                    <h5 class="lesson-section-subtitle">Important Note: "Home Office" ❌</h5>
                    <p class="lesson-note">
                        A common mistake is to use "home office" to mean "working from home." In English, "home office" refers to the *physical space* in your house where you work (e.g., "My home office is small"). To talk about the *activity* of working remotely, use **"work from home"** or **"remote work"**.
                        <button class="play-audio-button" data-text="A common mistake is to use home office to mean working from home. In English, home office refers to the physical space in your house where you work. To talk about the activity of working remotely, use work from home or remote work.">▶️ Play Audio</button>
                        <span id="home-office-note-en-spinner" class="loading-spinner hidden"></span>
                    </p>

                    <h5 class="lesson-section-subtitle">Common Uses of "In-Person" ✅</h5>
                    <ul class="lesson-examples-list">
                        <li>👉 <span class="highlight-expression">In-person meeting</span>
                            <button class="play-audio-button" data-text="In-person meeting">▶️ Play Audio</button>
                            <span id="inperson-use1-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">In-person training</span>
                            <button class="play-audio-button" data-text="In-person training">▶️ Play Audio</button>
                            <span id="inperson-use2-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">In-person course</span>
                            <button class="play-audio-button" data-text="In-person course">▶️ Play Audio</button>
                            <span id="inperson-use3-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">In-person interview</span>
                            <button class="play-audio-button" data-text="In-person interview">▶️ Play Audio</button>
                            <span id="inperson-use4-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">In-person event</span>
                            <button class="play-audio-button" data-text="In-person event">▶️ Play Audio</button>
                            <span id="inperson-use5-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">In-person workshop</span>
                            <button class="play-audio-button" data-text="In-person workshop">▶️ Play Audio</button>
                            <span id="inperson-use6-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">In-person consultation</span>
                            <button class="play-audio-button" data-text="In-person consultation">▶️ Play Audio</button>
                            <span id="inperson-use7-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">In-person session</span>
                            <button class="play-audio-button" data-text="In-person session">▶️ Play Audio</button>
                            <span id="inperson-use8-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">In-person assessment</span>
                            <button class="play-audio-button" data-text="In-person assessment">▶️ Play Audio</button>
                            <span id="inperson-use9-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">You can also say "On-site" ✅</h5>
                    <p class="lesson-note">
                        "On-site" is another common way to say "in-person," especially in a professional or work context. It means at the physical location of the work, rather than remotely.
                        <button class="play-audio-button" data-text="On-site is another common way to say in-person, especially in a professional or work context. It means at the physical location of the work, rather<seg_83>remotely.">▶️ Play Audio</button>
                        <span id="onsite-note-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <ul class="lesson-examples-list">
                        <li>👉 <span class="highlight-expression">On-site meeting</span>
                            <button class="play-audio-button" data-text="On-site meeting">▶️ Play Audio</button>
                            <span id="onsite-use1-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">On-site training</span>
                            <button class="play-audio-button" data-text="On-site training">▶️ Play Audio</button>
                            <span id="onsite-use2-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">On-site course</span>
                            <button class="play-audio-button" data-text="On-site course">▶️ Play Audio</button>
                            <span id="onsite-use3-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">On-site interview</span>
                            <button class="play-audio-button" data-text="On-site interview">▶️ Play Audio</button>
                            <span id="onsite-use4-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">On-site event</span>
                            <button class="play-audio-button" data-text="On-site event">▶️ Play Audio</button>
                            <span id="onsite-use5-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">On-site workshop</span>
                            <button class="play-audio-button" data-text="On-site workshop">▶️ Play Audio</button>
                            <span id="onsite-use6-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">On-site consultation</span>
                            <button class="play-audio-button" data-text="On-site consultation">▶️ Play Audio</button>
                            <span id="onsite-use7-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">On-site session</span>
                            <button class="play-audio-button" data-text="On-site session">▶️ Play Audio</button>
                            <span id="onsite-use8-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">On-site assessment</span>
                            <button class="play-audio-button" data-text="On-site assessment">▶️ Play Audio</button>
                            <span id="onsite-use9-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Translate these sentences: 🗣️</h5>
                    <ul class="translation-list">
                        <li><strong>Português:</strong> Eu trabalho de casa três vezes por semana.
                            <button class="play-audio-button" data-text="Eu trabalho de casa três vezes por semana.">▶️ Play Audio</button>
                            <span id="translate-location-pt-1-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-location-en-1" class="translation-input" rows="1" placeholder="Your English translation"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-location-en-1', 'translate-feedback-location-en-1', 'Eu trabalho de casa três vezes por semana.', 'en')">Check Answer</button>
                            <div id="translate-feedback-location-en-1" class="ai-feedback-box"></div>
                        </li>
                        <li><strong>Português:</strong> Ela trabalha presencialmente todos os dias.
                            <button class="play-audio-button" data-text="Ela trabalha presencialmente todos os dias.">▶️ Play Audio</button>
                            <span id="translate-location-pt-2-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-location-en-2" class="translation-input" rows="1" placeholder="Your English translation"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-location-en-2', 'translate-feedback-location-en-2', 'Ela trabalha presencialmente todos os dias.', 'en')">Check Answer</button>
                            <div id="translate-feedback-location-en-2" class="ai-feedback-box"></div>
                        </li>
                        <li><strong>Português:</strong> Eles trabalham de casa ou presencialmente?
                            <button class="play-audio-button" data-text="Eles trabalham de casa ou presencialmente?">▶️ Play Audio</button>
                            <span id="translate-location-pt-3-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-location-en-3" class="translation-input" rows="1" placeholder="Your English translation"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-location-en-3', 'translate-feedback-location-en-3', 'Eles trabalham de casa ou presencialmente?', 'en')">Check Answer</button>
                            <div id="translate-feedback-location-en-3" class="ai-feedback-box"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Exercise: Reorder the words! 🧩</h5>
                    <p class="reorder-prompt">Type the correct sentence:
                        <button class="play-audio-button" data-text="Type the correct sentence.">▶️ Play Audio</button>
                        <span id="reorder-location-prompt-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <ul class="reorder-exercise-list">
                        <li>1. home / from / I / work.
                            <button class="play-audio-button" data-text="home from I work.">▶️ Play Audio</button>
                            <span id="reorder-location-ex1-en-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-location-en-1" class="reorder-input" placeholder="Your answer">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-location-en-1', 'I work from home.', 'reorder-feedback-location-en-1')">Check Answer</button>
                            <div id="reorder-feedback-en-1" class="feedback-message"></div>
                        </li>
                        <li>2. in-person / She / works.
                            <button class="play-audio-button" data-text="in-person She works.">▶️ Play Audio</button>
                            <span id="reorder-location-ex2-en-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-location-en-2" class="reorder-input" placeholder="Your answer">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-location-en-2', 'She works in-person.', 'reorder-feedback-location-en-2')">Check Answer</button>
                            <div id="reorder-feedback-en-2" class="feedback-message"></div>
                        </li>
                        <li>3. days / work / They / from / some / home.
                            <button class="play-audio-button" data-text="days work They from some home.">▶️ Play Audio</button>
                            <span id="reorder-location-ex3-en-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-location-en-3" class="reorder-input" placeholder="Your answer">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-location-en-3', 'They work from home some days.', 'reorder-feedback-location-en-3')">Check Answer</button>
                            <div id="reorder-feedback-en-3" class="feedback-message"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Exercise: Complete with 'at' or 'in'! 📝</h5>
                    <p class="reorder-prompt">Choose the correct word(s):
                        <button class="play-audio-button" data-text="Choose the correct words.">▶️ Play Audio</button>
                        <span id="preposition-location-prompt-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <ul class="preposition-exercise-list">
                        <li>1. I work <input type="text" id="preposition-input-location-en-1" class="reorder-input w-24" placeholder="word(s)"> the main office.
                            <button class="play-audio-button" data-text="I work the main office.">▶️ Play Audio</button>
                            <span id="preposition-location-ex1-en-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-work-location', 'preposition-input-location-en-1', 'preposition-feedback-location-en-1', 'at')">Check Answer</button>
                            <div id="preposition-feedback-location-en-1" class="feedback-message"></div>
                        </li>
                        <li>2. She works <input type="text" id="preposition-input-location-en-2" class="reorder-input w-24" placeholder="word(s)"> marketing.
                            <button class="play-audio-button" data-text="She works marketing.">▶️ Play Audio</button>
                            <span id="preposition-location-ex2-en-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-work-location', 'preposition-input-location-en-2', 'preposition-feedback-location-en-2', 'in')">Check Answer</button>
                            <div id="preposition-feedback-location-en-2" class="feedback-message"></div>
                        </li>
                        <li>3. He prefers to work <input type="text" id="preposition-input-location-en-3" class="reorder-input w-24" placeholder="word(s)">.
                            <button class="play-audio-button" data-text="He prefers to work.">▶️ Play Audio</button>
                            <span id="preposition-location-ex3-en-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-work-location', 'preposition-input-location-en-3', 'preposition-feedback-location-en-3', 'in-person')">Check Answer</button>
                            <div id="preposition-feedback-location-en-3" class="feedback-message"></div>
                        </li>
                        <li>4. Many companies allow employees to work <input type="text" id="preposition-input-location-en-4" class="reorder-input w-24" placeholder="word(s)"> now.
                            <button class="play-audio-button" data-text="Many companies allow employees to work now.">▶️ Play Audio</button>
                            <span id="preposition-location-ex4-en-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-work-location', 'preposition-input-location-en-4', 'preposition-feedback-location-en-4', 'from home')">Check Answer</button>
                            <div id="preposition-feedback-location-en-4" class="ai-feedback-box"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Pergunte à IA: Você trabalha de casa ou presencialmente? 🤖</h5>
                    <p class="reorder-prompt">Tell us about your work location, or make up a sentence! The AI will give you feedback.
                        <button class="play-audio-button" data-text="Tell us about your work location, or make up a sentence! The AI will give you feedback.">▶️ Play Audio</button>
                        <span id="ai-location-prompt-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <textarea id="ai-check-input-location-en" class="ai-check-input" rows="3" placeholder="Example: I work from home three days a week."></textarea>
                    <button class="exercise-button" onclick="checkWithAI('ai-check-input-location-en', 'ai-feedback-location-en', 'Do you work from home or in-person?')">Check Answer</button>
                    <div id="ai-feedback-location-en" class="ai-feedback-box"></div>
                </div>
            </div>
            <div class="content-pt hidden">
                <h2 class="section-title">
                    Lição 3: Trabalho Remoto / Presencial 🏠🏢
                </h2>
                <div class="lesson-content">
                    <p class="lesson-intro" id="lesson3-intro-pt">
                        No mundo de hoje, é comum falar sobre onde você trabalha fisicamente. Usamos frases específicas para descrever se você trabalha remotamente ou em um local físico.
                        <button class="play-audio-button" data-text="No mundo de hoje, é comum falar sobre onde você trabalha fisicamente. Usamos frases específicas para descrever se você trabalha remotamente ou em um local físico.">▶️ Reproduzir Áudio</button>
                        <span id="lesson3-intro-pt-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <p><strong>Fórmulas para lembrar:</strong></p>
                    <div class="expression-box">
                        <span class="expression-text">Eu trabalho de casa.</span> ✨
                        <button class="play-audio-button" data-text="Eu trabalho de casa.">▶️ Reproduzir Áudio</button>
                        <span id="expression-box-home-pt-spinner" class="loading-spinner hidden"></span>
                    </div>
                    <div class="expression-box mt-4">
                        <span class="expression-text">Eu trabalho presencialmente.</span> ✨
                        <button class="play-audio-button" data-text="Eu trabalho presencialmente.">▶️ Reproduzir Áudio</button>
                        <span id="expression-box-inperson-pt-spinner" class="loading-spinner hidden"></span>
                    </div>
                    <p class="lesson-examples-title">Exemplos:</p>
                    <ul class="lesson-examples-list">
                        <li>👉 <span class="highlight-expression">Eu trabalho de casa</span> às segundas e sextas-feiras. 🏡
                            <button class="play-audio-button" data-text="Eu trabalho de casa às segundas e sextas-feiras.">▶️ Reproduzir Áudio</button>
                            <span id="location-example1-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Ela trabalha presencialmente</span> no escritório principal. 🏢
                            <button class="play-audio-button" data-text="Ela trabalha presencialmente no escritório principal.">▶️ Reproduzir Áudio</button>
                            <span id="location-example2-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 Devido à pandemia, muitas pessoas <span class="highlight-expression">trabalham de casa</span>. 💻
                            <button class="play-audio-button" data-text="Devido à pandemia, muitas pessoas trabalham de casa.">▶️ Reproduzir Áudio</button>
                            <span id="location-example3-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 Ele prefere <span class="highlight-expression">trabalhar presencialmente</span> para melhor colaboração. 🤝
                            <button class="play-audio-button" data-text="Ele prefere trabalhar presencialmente para melhor colaboração.">▶️ Reproduzir Áudio</button>
                            <span id="location-example4-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                    </ul>
                    <p class="lesson-note">
                        Lembre-se: <span class="highlight-text">"de casa"</span> indica trabalho remoto, enquanto <span class="highlight-text">"presencialmente"</span> indica trabalho em um local físico.
                        <button class="play-audio-button" data-text="Lembre-se: de casa indica trabalho remoto, enquanto presencialmente indica trabalho em um local físico.">▶️ Reproduzir Áudio</button>
                        <span id="lesson3-note-pt-spinner" class="loading-spinner hidden"></span>
                    </p>

                    <h5 class="lesson-section-subtitle">Observação Importante: "Home Office" ❌</h5>
                    <p class="lesson-note">
                        Um erro comum é usar "home office" para significar "trabalhar de casa". Em inglês, "home office" se refere ao *espaço físico* em sua casa onde você trabalha (ex: "My home office is small"). Para falar sobre a *atividade* de trabalhar remotamente, use **"work from home"** ou **"remote work"**.
                        <button class="play-audio-button" data-text="Um erro comum é usar home office para significar trabalhar de casa. Em inglês, home office se refere ao espaço físico em sua casa onde você trabalha. Para falar sobre a atividade de trabalhar remotamente, use work from home ou remote work.">▶️ Reproduzir Áudio</button>
                        <span id="home-office-note-pt-spinner" class="loading-spinner hidden"></span>
                    </p>

                    <h5 class="lesson-section-subtitle">Usos Comuns de "In-Person" ✅</h5>
                    <ul class="lesson-examples-list">
                        <li>👉 <span class="highlight-expression">Reunião presencial</span> (In-person meeting)
                            <button class="play-audio-button" data-text="Reunião presencial">▶️ Reproduzir Áudio</button>
                            <span id="inperson-use1-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Treinamento presencial</span> (In-person training)
                            <button class="play-audio-button" data-text="Treinamento presencial">▶️ Reproduzir Áudio</button>
                            <span id="inperson-use2-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Curso presencial</span> (In-person course)
                            <button class="play-audio-button" data-text="Curso presencial">▶️ Reproduzir Áudio</button>
                            <span id="inperson-use3-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Entrevista presencial</span> (In-person interview)
                            <button class="play-audio-button" data-text="Entrevista presencial">▶️ Reproduzir Áudio</button>
                            <span id="inperson-use4-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Evento presencial</span> (In-person event)
                            <button class="play-audio-button" data-text="Evento presencial">▶️ Reproduzir Áudio</button>
                            <span id="inperson-use5-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Workshop presencial</span> (In-person workshop)
                            <button class="play-audio-button" data-text="Workshop presencial">▶️ Reproduzir Áudio</button>
                            <span id="inperson-use6-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Consulta presencial</span> (In-person consultation)
                            <button class="play-audio-button" data-text="Consulta presencial">▶️ Reproduzir Áudio</button>
                            <span id="inperson-use7-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Sessão presencial</span> (In-person session)
                            <button class="play-audio-button" data-text="Sessão presencial">▶️ Reproduzir Áudio</button>
                            <span id="inperson-use8-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Avaliação presencial</span> (On-site assessment)
                            <button class="play-audio-button" data-text="Avaliação presencial">▶️ Reproduzir Áudio</button>
                            <span id="inperson-use9-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Você também pode dizer "On-site" ✅</h5>
                    <p class="lesson-note">
                        "On-site" é outra forma comum de dizer "presencialmente", especialmente em um contexto profissional ou de trabalho. Significa no local físico de trabalho, em vez de remotamente.
                        <button class="play-audio-button" data-text="On-site é outra forma comum de dizer presencialmente, especialmente em um contexto profissional ou de trabalho. Significa no local físico de trabalho, em vez de remotamente.">▶️ Reproduzir Áudio</button>
                        <span id="onsite-note-pt-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <ul class="lesson-examples-list">
                        <li>👉 <span class="highlight-expression">Reunião no local</span> (On-site meeting)
                            <button class="play-audio-button" data-text="Reunião no local">▶️ Reproduzir Áudio</button>
                            <span id="onsite-use1-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Treinamento no local</span> (On-site training)
                            <button class="play-audio-button" data-text="Treinamento no local">▶️ Reproduzir Áudio</button>
                            <span id="onsite-use2-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Curso no local</span> (On-site course)
                            <button class="play-audio-button" data-text="Curso no local">▶️ Reproduzir Áudio</button>
                            <span id="onsite-use3-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Entrevista no local</span> (On-site interview)
                            <button class="play-audio-button" data-text="Entrevista no local">▶️ Reproduzir Áudio</button>
                            <span id="onsite-use4-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Evento no local</span> (On-site event)
                            <button class="play-audio-button" data-text="Evento no local">▶️ Reproduzir Áudio</button>
                            <span id="onsite-use5-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Workshop no local</span> (On-site workshop)
                            <button class="play-audio-button" data-text="Workshop no local">▶️ Reproduzir Áudio</button>
                            <span id="onsite-use6-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Consulta no local</span> (On-site consultation)
                            <button class="play-audio-button" data-text="Consulta no local">▶️ Reproduzir Áudio</button>
                            <span id="onsite-use7-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Sessão no local</span> (On-site session)
                            <button class="play-audio-button" data-text="Sessão no local">▶️ Reproduzir Áudio</button>
                            <span id="onsite-use8-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Avaliação no local</span> (On-site assessment)
                            <button class="play-audio-button" data-text="Avaliação no local">▶️ Reproduzir Áudio</button>
                            <span id="onsite-use9-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Traduza estas frases: 🗣️</h5>
                    <ul class="translation-list">
                        <li><strong>Português:</strong> Eu trabalho de casa três vezes por semana.
                            <button class="play-audio-button" data-text="Eu trabalho de casa três vezes por semana.">▶️ Play Audio</button>
                            <span id="translate-location-pt-1-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-location-en-1" class="translation-input" rows="1" placeholder="Your English translation"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-location-en-1', 'translate-feedback-location-en-1', 'Eu trabalho de casa três vezes por semana.', 'en')">Check Answer</button>
                            <div id="translate-feedback-location-en-1" class="ai-feedback-box"></div>
                        </li>
                        <li><strong>Português:</strong> Ela trabalha presencialmente todos os dias.
                            <button class="play-audio-button" data-text="Ela trabalha presencialmente todos os dias.">▶️ Play Audio</button>
                            <span id="translate-location-pt-2-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-location-en-2" class="translation-input" rows="1" placeholder="Your English translation"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-location-en-2', 'translate-feedback-location-en-2', 'Ela trabalha presencialmente todos os dias.', 'en')">Check Answer</button>
                            <div id="translate-feedback-location-en-2" class="ai-feedback-box"></div>
                        </li>
                        <li><strong>Português:</strong> Eles trabalham de casa ou presencialmente?
                            <button class="play-audio-button" data-text="Eles trabalham de casa ou presencialmente?">▶️ Play Audio</button>
                            <span id="translate-location-pt-3-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-location-en-3" class="translation-input" rows="1" placeholder="Your English translation"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-location-en-3', 'translate-feedback-location-en-3', 'Eles trabalham de casa ou presencialmente?', 'en')">Check Answer</button>
                            <div id="translate-feedback-location-en-3" class="ai-feedback-box"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Exercise: Reorder the words! 🧩</h5>
                    <p class="reorder-prompt">Type the correct sentence:
                        <button class="play-audio-button" data-text="Type the correct sentence.">▶️ Play Audio</button>
                        <span id="reorder-location-prompt-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <ul class="reorder-exercise-list">
                        <li>1. home / from / I / work.
                            <button class="play-audio-button" data-text="home from I work.">▶️ Play Audio</button>
                            <span id="reorder-location-ex1-en-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-location-en-1" class="reorder-input" placeholder="Your answer">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-location-en-1', 'I work from home.', 'reorder-feedback-location-en-1')">Check Answer</button>
                            <div id="reorder-feedback-en-1" class="feedback-message"></div>
                        </li>
                        <li>2. in-person / She / works.
                            <button class="play-audio-button" data-text="in-person She works.">▶️ Play Audio</button>
                            <span id="reorder-location-ex2-en-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-location-en-2" class="reorder-input" placeholder="Your answer">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-location-en-2', 'She works in-person.', 'reorder-feedback-location-en-2')">Check Answer</button>
                            <div id="reorder-feedback-en-2" class="feedback-message"></div>
                        </li>
                        <li>3. days / work / They / from / some / home.
                            <button class="play-audio-button" data-text="days work They from some home.">▶️ Play Audio</button>
                            <span id="reorder-location-ex3-en-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-location-en-3" class="reorder-input" placeholder="Your answer">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-location-en-3', 'They work from home some days.', 'reorder-feedback-location-en-3')">Check Answer</button>
                            <div id="reorder-feedback-en-3" class="feedback-message"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Exercício: Complete com 'at' ou 'in'! 📝</h5>
                    <p class="reorder-prompt">Escolha a(s) palavra(s) correta(s):
                        <button class="play-audio-button" data-text="Escolha a ou as palavras corretas.">▶️ Reproduzir Áudio</button>
                        <span id="preposition-location-prompt-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <ul class="preposition-exercise-list">
                        <li>1. I work <input type="text" id="preposition-input-location-en-1" class="reorder-input w-24" placeholder="word(s)"> the main office.
                            <button class="play-audio-button" data-text="I work the main office.">▶️ Play Audio</button>
                            <span id="preposition-location-ex1-en-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-work-location', 'preposition-input-location-en-1', 'preposition-feedback-location-en-1', 'at')">Check Answer</button>
                            <div id="preposition-feedback-location-en-1" class="feedback-message"></div>
                        </li>
                        <li>2. She works <input type="text" id="preposition-input-location-en-2" class="reorder-input w-24" placeholder="word(s)"> marketing.
                            <button class="play-audio-button" data-text="She works marketing.">▶️ Play Audio</button>
                            <span id="preposition-location-ex2-en-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-work-location', 'preposition-input-location-en-2', 'preposition-feedback-location-en-2', 'in')">Check Answer</button>
                            <div id="preposition-feedback-location-en-2" class="feedback-message"></div>
                        </li>
                        <li>3. He prefers to work <input type="text" id="preposition-input-location-en-3" class="reorder-input w-24" placeholder="word(s)">.
                            <button class="play-audio-button" data-text="He prefers to work.">▶️ Play Audio</button>
                            <span id="preposition-location-ex3-en-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-work-location', 'preposition-input-location-en-3', 'preposition-feedback-location-en-3', 'in-person')">Check Answer</button>
                            <div id="preposition-feedback-location-en-3" class="feedback-message"></div>
                        </li>
                        <li>4. Many companies allow employees to work <input type="text" id="preposition-input-location-en-4" class="reorder-input w-24" placeholder="word(s)"> now.
                            <button class="play-audio-button" data-text="Many companies allow employees to work now.">▶️ Play Audio</button>
                            <span id="preposition-location-ex4-en-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-work-location', 'preposition-input-location-en-4', 'preposition-feedback-location-en-4', 'from home')">Check Answer</button>
                            <div id="preposition-feedback-location-en-4" class="ai-feedback-box"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Pergunte à IA: Você trabalha de casa ou presencialmente? 🤖</h5>
                    <p class="reorder-prompt">Diga-nos sobre seu local de trabalho, ou invente uma frase! A IA lhe dará feedback.
                        <button class="play-audio-button" data-text="Diga-nos sobre seu local de trabalho, ou invente uma frase! A IA lhe dará feedback.">▶️ Play Audio</button>
                        <span id="ai-location-prompt-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <textarea id="ai-check-input-location-en" class="ai-check-input" rows="3" placeholder="Example: I work from home three days a week."></textarea>
                    <button class="exercise-button" onclick="checkWithAI('ai-check-input-location-en', 'ai-feedback-location-en', 'Do you work from home or in-person?')">Check Answer</button>
                    <div id="ai-feedback-location-en" class="ai-feedback-box"></div>
                </div>
            </div>
            <div class="content-pt hidden">
                <h2 class="section-title">
                    Lição 3: Trabalho Remoto / Presencial 🏠🏢
                </h2>
                <div class="lesson-content">
                    <p class="lesson-intro" id="lesson3-intro-pt">
                        No mundo de hoje, é comum falar sobre onde você trabalha fisicamente. Usamos frases específicas para descrever se você trabalha remotamente ou em um local físico.
                        <button class="play-audio-button" data-text="No mundo de hoje, é comum falar sobre onde você trabalha fisicamente. Usamos frases específicas para descrever se você trabalha remotamente ou em um local físico.">▶️ Reproduzir Áudio</button>
                        <span id="lesson3-intro-pt-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <p><strong>Fórmulas para lembrar:</strong></p>
                    <div class="expression-box">
                        <span class="expression-text">Eu trabalho de casa.</span> ✨
                        <button class="play-audio-button" data-text="Eu trabalho de casa.">▶️ Reproduzir Áudio</button>
                        <span id="expression-box-home-pt-spinner" class="loading-spinner hidden"></span>
                    </div>
                    <div class="expression-box mt-4">
                        <span class="expression-text">Eu trabalho presencialmente.</span> ✨
                        <button class="play-audio-button" data-text="Eu trabalho presencialmente.">▶️ Reproduzir Áudio</button>
                        <span id="expression-box-inperson-pt-spinner" class="loading-spinner hidden"></span>
                    </div>
                    <p class="lesson-examples-title">Exemplos:</p>
                    <ul class="lesson-examples-list">
                        <li>👉 <span class="highlight-expression">Eu trabalho de casa</span> às segundas e sextas-feiras. 🏡
                            <button class="play-audio-button" data-text="Eu trabalho de casa às segundas e sextas-feiras.">▶️ Reproduzir Áudio</button>
                            <span id="location-example1-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Ela trabalha presencialmente</span> no escritório principal. 🏢
                            <button class="play-audio-button" data-text="Ela trabalha presencialmente no escritório principal.">▶️ Reproduzir Áudio</button>
                            <span id="location-example2-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 Devido à pandemia, muitas pessoas <span class="highlight-expression">trabalham de casa</span>. 💻
                            <button class="play-audio-button" data-text="Devido à pandemia, muitas pessoas trabalham de casa.">▶️ Reproduzir Áudio</button>
                            <span id="location-example3-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 Ele prefere <span class="highlight-expression">trabalhar presencialmente</span> para melhor colaboração. 🤝
                            <button class="play-audio-button" data-text="Ele prefere trabalhar presencialmente para melhor colaboração.">▶️ Reproduzir Áudio</button>
                            <span id="location-example4-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                    </ul>
                    <p class="lesson-note">
                        Lembre-se: <span class="highlight-text">"de casa"</span> indica trabalho remoto, enquanto <span class="highlight-text">"presencialmente"</span> indica trabalho em um local físico.
                        <button class="play-audio-button" data-text="Lembre-se: de casa indica trabalho remoto, enquanto presencialmente indica trabalho em um local físico.">▶️ Reproduzir Áudio</button>
                        <span id="lesson3-note-pt-spinner" class="loading-spinner hidden"></span>
                    </p>

                    <h5 class="lesson-section-subtitle">Observação Importante: "Home Office" ❌</h5>
                    <p class="lesson-note">
                        Um erro comum é usar "home office" para significar "trabalhar de casa". Em inglês, "home office" se refere ao *espaço físico* em sua casa onde você trabalha (ex: "My home office is small"). Para falar sobre a *atividade* de trabalhar remotamente, use **"work from home"** ou **"remote work"**.
                        <button class="play-audio-button" data-text="Um erro comum é usar home office para significar trabalhar de casa. Em inglês, home office se refere ao espaço físico em sua casa onde você trabalha. Para falar sobre a atividade de trabalhar remotamente, use work from home ou remote work.">▶️ Reproduzir Áudio</button>
                        <span id="home-office-note-pt-spinner" class="loading-spinner hidden"></span>
                    </p>

                    <h5 class="lesson-section-subtitle">Usos Comuns de "In-Person" ✅</h5>
                    <ul class="lesson-examples-list">
                        <li>👉 <span class="highlight-expression">Reunião presencial</span> (In-person meeting)
                            <button class="play-audio-button" data-text="Reunião presencial">▶️ Reproduzir Áudio</button>
                            <span id="inperson-use1-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Treinamento presencial</span> (In-person training)
                            <button class="play-audio-button" data-text="Treinamento presencial">▶️ Reproduzir Áudio</button>
                            <span id="inperson-use2-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Curso presencial</span> (In-person course)
                            <button class="play-audio-button" data-text="Curso presencial">▶️ Reproduzir Áudio</button>
                            <span id="inperson-use3-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Entrevista presencial</span> (In-person interview)
                            <button class="play-audio-button" data-text="Entrevista presencial">▶️ Reproduzir Áudio</button>
                            <span id="inperson-use4-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Evento presencial</span> (In-person event)
                            <button class="play-audio-button" data-text="Evento presencial">▶️ Reproduzir Áudio</button>
                            <span id="inperson-use5-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Workshop presencial</span> (In-person workshop)
                            <button class="play-audio-button" data-text="Workshop presencial">▶️ Reproduzir Áudio</button>
                            <span id="inperson-use6-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Consulta presencial</span> (In-person consultation)
                            <button class="play-audio-button" data-text="Consulta presencial">▶️ Reproduzir Áudio</button>
                            <span id="inperson-use7-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Sessão presencial</span> (In-person session)
                            <button class="play-audio-button" data-text="Sessão presencial">▶️ Reproduzir Áudio</button>
                            <span id="inperson-use8-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Avaliação presencial</span> (On-site assessment)
                            <button class="play-audio-button" data-text="Avaliação presencial">▶️ Reproduzir Áudio</button>
                            <span id="inperson-use9-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Você também pode dizer "On-site" ✅</h5>
                    <p class="lesson-note">
                        "On-site" é outra forma comum de dizer "presencialmente", especialmente em um contexto profissional ou de trabalho. Significa no local físico de trabalho, em vez de remotamente.
                        <button class="play-audio-button" data-text="On-site é outra forma comum de dizer presencialmente, especialmente em um contexto profissional ou de trabalho. Significa no local físico de trabalho, em vez de remotamente.">▶️ Reproduzir Áudio</button>
                        <span id="onsite-note-pt-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <ul class="lesson-examples-list">
                        <li>👉 <span class="highlight-expression">Reunião no local</span> (On-site meeting)
                            <button class="play-audio-button" data-text="Reunião no local">▶️ Reproduzir Áudio</button>
                            <span id="onsite-use1-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Treinamento no local</span> (On-site training)
                            <button class="play-audio-button" data-text="Treinamento no local">▶️ Reproduzir Áudio</button>
                            <span id="onsite-use2-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Curso no local</span> (On-site course)
                            <button class="play-audio-button" data-text="Curso no local">▶️ Reproduzir Áudio</button>
                            <span id="onsite-use3-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Entrevista no local</span> (On-site interview)
                            <button class="play-audio-button" data-text="Entrevista no local">▶️ Reproduzir Áudio</button>
                            <span id="onsite-use4-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Evento no local</span> (On-site event)
                            <button class="play-audio-button" data-text="Evento no local">▶️ Reproduzir Áudio</button>
                            <span id="onsite-use5-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Workshop no local</span> (On-site workshop)
                            <button class="play-audio-button" data-text="Workshop no local">▶️ Reproduzir Áudio</button>
                            <span id="onsite-use6-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Consulta no local</span> (On-site consultation)
                            <button class="play-audio-button" data-text="Consulta no local">▶️ Reproduzir Áudio</button>
                            <span id="onsite-use7-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Sessão no local</span> (On-site session)
                            <button class="play-audio-button" data-text="Sessão no local">▶️ Reproduzir Áudio</button>
                            <span id="onsite-use8-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Avaliação no local</span> (On-site assessment)
                            <button class="play-audio-button" data-text="Avaliação no local">▶️ Reproduzir Áudio</button>
                            <span id="onsite-use9-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Traduza estas frases: 🗣️</h5>
                    <ul class="translation-list">
                        <li><strong>Português:</strong> Eu trabalho de casa três vezes por semana.
                            <button class="play-audio-button" data-text="Eu trabalho de casa três vezes por semana.">▶️ Play Audio</button>
                            <span id="translate-location-pt-1-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-location-en-1" class="translation-input" rows="1" placeholder="Your English translation"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-location-en-1', 'translate-feedback-location-en-1', 'Eu trabalho de casa três vezes por semana.', 'en')">Check Answer</button>
                            <div id="translate-feedback-location-en-1" class="ai-feedback-box"></div>
                        </li>
                        <li><strong>Português:</strong> Ela trabalha presencialmente todos os dias.
                            <button class="play-audio-button" data-text="Ela trabalha presencialmente todos os dias.">▶️ Play Audio</button>
                            <span id="translate-location-pt-2-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-location-en-2" class="translation-input" rows="1" placeholder="Your English translation"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-location-en-2', 'translate-feedback-location-en-2', 'Ela trabalha presencialmente todos os dias.', 'en')">Check Answer</button>
                            <div id="translate-feedback-location-en-2" class="ai-feedback-box"></div>
                        </li>
                        <li><strong>Português:</strong> Eles trabalham de casa ou presencialmente?
                            <button class="play-audio-button" data-text="Eles trabalham de casa ou presencialmente?">▶️ Play Audio</button>
                            <span id="translate-location-pt-3-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-location-en-3" class="translation-input" rows="1" placeholder="Your English translation"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-location-en-3', 'translate-feedback-location-en-3', 'Eles trabalham de casa ou presencialmente?', 'en')">Check Answer</button>
                            <div id="translate-feedback-location-en-3" class="ai-feedback-box"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Exercise: Reorder the words! 🧩</h5>
                    <p class="reorder-prompt">Type the correct sentence:
                        <button class="play-audio-button" data-text="Type the correct sentence.">▶️ Play Audio</button>
                        <span id="reorder-location-prompt-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <ul class="reorder-exercise-list">
                        <li>1. home / from / I / work.
                            <button class="play-audio-button" data-text="home from I work.">▶️ Play Audio</button>
                            <span id="reorder-location-ex1-en-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-location-en-1" class="reorder-input" placeholder="Your answer">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-location-en-1', 'I work from home.', 'reorder-feedback-location-en-1')">Check Answer</button>
                            <div id="reorder-feedback-en-1" class="feedback-message"></div>
                        </li>
                        <li>2. in-person / She / works.
                            <button class="play-audio-button" data-text="in-person She works.">▶️ Play Audio</button>
                            <span id="reorder-location-ex2-en-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-location-en-2" class="reorder-input" placeholder="Your answer">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-location-en-2', 'She works in-person.', 'reorder-feedback-location-en-2')">Check Answer</button>
                            <div id="reorder-feedback-en-2" class="feedback-message"></div>
                        </li>
                        <li>3. days / work / They / from / some / home.
                            <button class="play-audio-button" data-text="days work They from some home.">▶️ Play Audio</button>
                            <span id="reorder-location-ex3-en-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-location-en-3" class="reorder-input" placeholder="Your answer">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-location-en-3', 'They work from home some days.', 'reorder-feedback-location-en-3')">Check Answer</button>
                            <div id="reorder-feedback-en-3" class="feedback-message"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Exercício: Complete com 'at' ou 'in'! 📝</h5>
                    <p class="reorder-prompt">Escolha a(s) palavra(s) correta(s):
                        <button class="play-audio-button" data-text="Escolha a ou as palavras corretas.">▶️ Reproduzir Áudio</button>
                        <span id="preposition-location-prompt-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <ul class="preposition-exercise-list">
                        <li>1. I work <input type="text" id="preposition-input-location-en-1" class="reorder-input w-24" placeholder="word(s)"> the main office.
                            <button class="play-audio-button" data-text="I work the main office.">▶️ Play Audio</button>
                            <span id="preposition-location-ex1-en-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-work-location', 'preposition-input-location-en-1', 'preposition-feedback-location-en-1', 'at')">Check Answer</button>
                            <div id="preposition-feedback-location-en-1" class="feedback-message"></div>
                        </li>
                        <li>2. She works <input type="text" id="preposition-input-location-en-2" class="reorder-input w-24" placeholder="word(s)"> marketing.
                            <button class="play-audio-button" data-text="She works marketing.">▶️ Play Audio</button>
                            <span id="preposition-location-ex2-en-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-work-location', 'preposition-input-location-en-2', 'preposition-feedback-location-en-2', 'in')">Check Answer</button>
                            <div id="preposition-feedback-location-en-2" class="feedback-message"></div>
                        </li>
                        <li>3. He prefers to work <input type="text" id="preposition-input-location-en-3" class="reorder-input w-24" placeholder="word(s)">.
                            <button class="play-audio-button" data-text="He prefers to work.">▶️ Play Audio</button>
                            <span id="preposition-location-ex3-en-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-work-location', 'preposition-input-location-en-3', 'preposition-feedback-location-en-3', 'in-person')">Check Answer</button>
                            <div id="preposition-feedback-location-en-3" class="feedback-message"></div>
                        </li>
                        <li>4. Many companies allow employees to work <input type="text" id="preposition-input-location-en-4" class="reorder-input w-24" placeholder="word(s)"> now.
                            <button class="play-audio-button" data-text="Many companies allow employees to work now.">▶️ Play Audio</button>
                            <span id="preposition-location-ex4-en-spinner" class="loading-spinner hidden"></span>
                            <button class="exercise-button" onclick="checkAnswer('section-work-location', 'preposition-input-location-en-4', 'preposition-feedback-location-en-4', 'from home')">Check Answer</button>
                            <div id="preposition-feedback-location-en-4" class="ai-feedback-box"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Pergunte à IA: Você trabalha de casa ou presencialmente? 🤖</h5>
                    <p class="reorder-prompt">Diga-nos sobre seu local de trabalho, ou invente uma frase! A IA lhe dará feedback.
                        <button class="play-audio-button" data-text="Diga-nos sobre seu local de trabalho, ou invente uma frase! A IA lhe dará feedback.">▶️ Play Audio</button>
                        <span id="ai-location-prompt-pt-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <textarea id="ai-check-input-location-pt" class="ai-check-input" rows="3" placeholder="Exemplo: Eu trabalho de casa três dias por semana."></textarea>
                    <button class="exercise-button" onclick="checkWithAI('ai-check-input-location-pt', 'ai-feedback-location-pt', 'Você trabalha de casa ou presencialmente?')">Check Answer</button>
                    <div id="ai-feedback-location-pt" class="ai-feedback-box"></div>
                </div>
            </div>
        </section>

        <!-- New Section 4: Rescheduling a Meeting -->
        <section id="section-reschedule" class="content-card">
            <div class="lang-buttons">
                <button class="lang-btn active" data-lang="en" data-section="section-reschedule">English</button>
                <button class="lang-btn" data-lang="pt" data-section="section-reschedule">Português</button>
            </div>
            <div class="content-en">
                <h2 class="section-title">
                    Lesson 4: Rescheduling a Meeting 🗓️
                </h2>
                <div class="lesson-content">
                    <p class="lesson-intro" id="lesson4-intro-en">
                        First, let's clarify: <span class="highlight-text">meet</span> is a verb (to encounter or come together), and <span class="highlight-text">meeting</span> is a noun (an assembly or gathering, e.g., a work meeting).
                        <button class="play-audio-button" data-text="First, let's clarify: meet is a verb, to encounter or come together, and meeting is a noun, an assembly or gathering, for example, a work meeting.">▶️ Play Audio</button>
                        <span id="lesson4-intro-en-spinner" class="loading-spinner hidden"></span>
                        <br><br>
                        Sometimes, you can't make it to a meeting. It's important to know how to politely decline and suggest a new time.
                        <button class="play-audio-button" data-text="Sometimes, you can't make it to a meeting. It's important to know how to politely decline and suggest a new time.">▶️ Play Audio</button>
                        <span id="lesson4-intro-en-part2-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <p><strong>Polite Declines:</strong></p>
                    <ul class="lesson-examples-list">
                        <li>👉 <span class="highlight-expression">I'm afraid I can't make it.</span>
                            <button class="play-audio-button" data-text="I'm afraid I can't make it.">▶️ Play Audio</button>
                            <span id="decline1-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">I'm sorry, I can't make it.</span>
                            <button class="play-audio-button" data-text="I'm sorry, I can't make it.">▶️ Play Audio</button>
                            <span id="decline2-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">I can't make it.</span>
                            <button class="play-audio-button" data-text="I can't make it.">▶️ Play Audio</button>
                            <span id="decline3-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                    </ul>

                    <!-- New Explanation Box for Polite Declines -->
                    <div class="explanation-box fade-in">
                        <div class="lang-buttons">
                            <button class="lang-btn active" data-lang="en" data-section="explanation-decline">English</button>
                            <button class="lang-btn" data-lang="pt" data-section="explanation-decline">Português</button>
                        </div>
                        <div class="content-en">
                            <h4>Understanding Polite Declines:</h4>
                            <p>
                                The phrase "I can't make it" is a direct and clear way to state your inability to attend. While concise, it can sound somewhat abrupt on its own, especially in formal or professional contexts.
                                <button class="play-audio-button" data-text="The phrase I can't make it is a direct and clear way to state your inability to attend. While concise, it can sound somewhat abrupt on its own, especially in formal or professional contexts.">▶️ Play Audio</button>
                                <span id="explain-decline-en-spinner1-new" class="loading-spinner hidden"></span>
                            </p>
                            <p>
                                To soften this directness and convey politeness, English speakers often add a preceding phrase:
                                <ul>
                                    <li>The phrase "<strong>I'm afraid</strong>" here is not about fear. Instead, it conveys a gentle sense of regret or reluctance to deliver news that might be disappointing. It softens the refusal, making it more empathetic and less abrupt. Think of it as a polite preamble to a negative statement.
                                        <button class="play-audio-button" data-text="The phrase I'm afraid here is not about fear. Instead, it conveys a gentle sense of regret or reluctance to deliver news that might be disappointing. It softens the refusal, making it more empathetic and less abrupt. Think of it as a polite preamble to a negative statement.">▶️ Play Audio</button>
                                        <span id="explain-decline-en-spinner2" class="loading-spinner hidden"></span>
                                    </li>
                                    <li>"<strong>I'm sorry</strong>" is a direct and clear apology for any inconvenience your absence may cause. It explicitly acknowledges the potential impact on the other person.
                                        <button class="play-audio-button" data-text="I'm sorry is a direct and clear apology for any inconvenience your absence may cause. It explicitly acknowledges the potential impact on the other person.">▶️ Play Audio</button>
                                        <span id="explain-decline-en-spinner3" class="loading-spinner hidden"></span>
                                    </li>
                                </ul>
                            </p>
                            <p>
                                Both "<strong>I'm afraid I can't make it</strong>" and "<strong>I'm sorry, I can't make it</strong>" are highly professional and demonstrate respect for the other person's time and plans, which is crucial in English business communication. They are always preferred over a simple "No" or "I can't go" when you want to maintain a polite and respectful tone.
                                <button class="play-audio-button" data-text="Both I'm afraid I can't make it and I'm sorry, I can't make it are highly professional and demonstrate respect for the other person's time and plans, which is crucial in English business communication. They are always preferred over a simple No or I can't go.">▶️ Play Audio</button>
                                <span id="explain-decline-en-spinner4" class="loading-spinner hidden"></span>
                            </p>
                        </div>
                        <div class="content-pt hidden">
                            <h4>Entendendo as Recusas Educadas:</h4>
                            <p>
                                A frase "I can't make it" (Não consigo ir) é uma forma direta e clara de expressar sua incapacidade de comparecer. Embora concisa, ela pode soar um tanto abrupta por si só, especialmente em contextos formais ou profissionais.
                                <button class="play-audio-button" data-text="A frase I can't make it, Não consigo ir, é uma forma direta e clara de expressar sua incapacidade de comparecer. Embora concisa, ela pode soar um tanto abrupta por si só, especialmente em contextos formais ou profissionais.">▶️ Reproduzir Áudio</button>
                                <span id="explain-decline-pt-spinner1-new" class="loading-spinner hidden"></span>
                            </p>
                            <p>
                                Para suavizar essa franqueza e transmitir polidez, falantes de inglês frequentemente adicionam uma frase anterior:
                                <ul>
                                    <li>A expressão "<strong>I'm afraid</strong>" (Receio) aqui não se refere a ter medo. Em vez disso, ela transmite um **sentimento de lamento ou relutância** ao dar uma notícia que pode ser decepcionante. Ela suaviza a recusa, tornando-a mais empática e menos direta. Pense nela como um preâmbulo educado para uma afirmação negativa.
                                        <button class="play-audio-button" data-text="A expressão I'm afraid, Receio, aqui não se refere a ter medo. Em vez disso, ela transmite um sentimento de lamento ou relutância ao dar uma notícia que pode ser decepcionante. Ela suaviza a recusa, tornando-a mais empática e menos direta. Pense nela como um preâmbulo educado para uma afirmação negativa.">▶️ Reproduzir Áudio</button>
                                        <span id="explain-decline-pt-spinner2" class="loading-spinner hidden"></span>
                                    </li>
                                    <li>"<strong>I'm sorry</strong>" (Lamento/Sinto muito) é um pedido de desculpas direto e claro por qualquer inconveniente que sua ausência possa causar. Ele reconhece explicitamente o impacto potencial na outra pessoa.
                                        <button class="play-audio-button" data-text="I'm sorry, Lamento, Sinto muito, é um pedido de desculpas direto e claro por qualquer inconveniente que sua ausência possa causar. Ele reconhece explicitamente o impacto potencial na outra pessoa.">▶️ Reproduzir Áudio</button>
                                        <span id="explain-decline-pt-spinner3" class="loading-spinner hidden"></span>
                                    </li>
                                </ul>
                            </p>
                            <p>
                                Tanto "<strong>I'm afraid I can't make it</strong>" quanto "<strong>I'm sorry, I can't make it</strong>" são **altamente profissionais** e demonstram respeito pelo tempo e pelos planos da outra pessoa, o que é crucial na comunicação empresarial em inglês. Elas são sempre preferíveis a um simples "Não" ou "Não posso ir" quando você deseja manter um tom educado e respeitoso.
                                <button class="play-audio-button" data-text="Tanto I'm afraid I can't make it quanto I'm sorry, I can't make it são altamente profissionais e demonstram respeito pelo tempo e pelos planos da outra pessoa, o que é crucial na comunicação empresarial em inglês. Elas são sempre preferíveis a um simples Não ou Não posso ir quando você deseja manter um tom educado e respeitoso.">▶️ Reproduzir Áudio</button>
                                <span id="explain-decline-pt-spinner4" class="loading-spinner hidden"></span>
                            </p>
                        </div>
                    </div>

                    <p class="lesson-note">
                        You can follow up with a brief <span class="highlight-text">reason</span> if appropriate.
                        <button class="play-audio-button" data-text="You can follow up with a brief reason if appropriate.">▶️ Play Audio</button>
                        <span id="decline-note-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <p class="lesson-examples-title">Examples with Reason:</p>
                    <ul class="lesson-examples-list">
                        <li>👉 <span class="highlight-expression">I'm afraid I can't make it. The reason is I have another appointment.</span>
                            <button class="play-audio-button" data-text="I'm afraid I can't make it. The reason is I have another appointment.">▶️ Play Audio</button>
                            <span id="decline-reason1-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">I'm sorry, I can't make it. I have a prior commitment.</span>
                            <button class="play-audio-button" data-text="I'm sorry, I can't make it. I have a prior commitment.">▶️ Play Audio</button>
                            <span id="decline-reason2-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                    </ul>

                    <p><strong>Suggesting a Reschedule:</strong></p>
                    <ul class="lesson-examples-list">
                        <li>👉 <span class="highlight-expression">May I take a rain check?</span> (Informal, means reschedule for another time)
                            <button class="play-audio-button" data-text="May I take a rain check? Informal, means reschedule for another time.">▶️ Play Audio</button>
                            <span id="reschedule1-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Could we reschedule?</span>
                            <button class="play-audio-button" data-text="Could we reschedule?">▶️ Play Audio</button>
                            <span id="reschedule2-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                    </ul>
                    <p class="lesson-note">
                        When you <span class="highlight-text">can make it</span>, it's good to <span class="highlight-text">suggest a different time and day</span>.
                        <button class="play-audio-button" data-text="When you can make it, it's good to suggest a different time and day.">▶️ Play Audio</button>
                        <span id="reschedule-note-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <p class="lesson-examples-title">Examples of Suggesting New Times:</p>
                    <ul class="lesson-examples-list">
                        <li>👉 <span class="highlight-expression">I can make it on Tuesday afternoon.</span>
                            <button class="play-audio-button" data-text="I can make it on Tuesday afternoon.">▶️ Play Audio</button>
                            <span id="reschedule-time1-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Could we reschedule for next Monday?</span>
                            <button class="play-audio-button" data-text="Could we reschedule for next Monday?">▶️ Play Audio</button>
                            <span id="reschedule-time2-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">I'm sorry, I can't make it today. How about we meet tomorrow at 10 AM?</span>
                            <button class="play-audio-button" data-text="I'm sorry, I can't make it today. How about we meet tomorrow at 10 AM?">▶️ Play Audio</button>
                            <span id="reschedule-time3-en-spinner" class="loading-spinner hidden"></span>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Translate these sentences: 🗣️</h5>
                    <ul class="translation-list">
                        <li><strong>Português:</strong> Receio não poder comparecer.
                            <button class="play-audio-button" data-text="Receio não poder comparecer.">▶️ Play Audio</button>
                            <span id="translate-reschedule-pt-1-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-reschedule-en-1" class="translation-input" rows="1" placeholder="Your English translation"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-reschedule-en-1', 'translate-feedback-reschedule-en-1', 'Receio não poder comparecer.', 'en')">Check Answer</button>
                            <div id="translate-feedback-reschedule-en-1" class="ai-feedback-box"></div>
                        </li>
                        <li><strong>Português:</strong> Podemos remarcar?
                            <button class="play-audio-button" data-text="Podemos remarcar?">▶️ Play Audio</button>
                            <span id="translate-reschedule-pt-2-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-reschedule-en-2" class="translation-input" rows="1" placeholder="Your English translation"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-reschedule-en-2', 'translate-feedback-reschedule-en-2', 'Podemos remarcar?', 'en')">Check Answer</button>
                            <div id="translate-feedback-reschedule-en-2" class="ai-feedback-box"></div>
                        </li>
                        <li><strong>Português:</strong> Eu posso ir na quarta-feira.
                            <button class="play-audio-button" data-text="Eu posso ir na quarta-feira.">▶️ Play Audio</button>
                            <span id="translate-reschedule-pt-3-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-reschedule-en-3" class="translation-input" rows="1" placeholder="Your English translation"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-reschedule-en-3', 'translate-feedback-reschedule-en-3', 'Eu posso ir na quarta-feira.', 'en')">Check Answer</button>
                            <div id="translate-feedback-reschedule-en-3" class="ai-feedback-box"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Exercise: Reorder the words! 🧩</h5>
                    <p class="reorder-prompt">Type the correct sentence:
                        <button class="play-audio-button" data-text="Type the correct sentence.">▶️ Play Audio</button>
                        <span id="reorder-reschedule-prompt-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <ul class="reorder-exercise-list">
                        <li>1. make / I / it / can't / afraid / I'm.
                            <button class="play-audio-button" data-text="make I it can't afraid I'm.">▶️ Play Audio</button>
                            <span id="reorder-reschedule-ex1-en-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-reschedule-en-1" class="reorder-input" placeholder="Your answer">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-reschedule-en-1', 'I\'m afraid I can\'t make it.', 'reorder-feedback-reschedule-en-1')">Check Answer</button>
                            <div id="reorder-feedback-reschedule-en-1" class="feedback-message"></div>
                        </li>
                        <li>2. reschedule / we / Could?
                            <button class="play-audio-button" data-text="reschedule we Could?">▶️ Play Audio</button>
                            <span id="reorder-reschedule-ex2-en-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-reschedule-en-2" class="reorder-input" placeholder="Your answer">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-reschedule-en-2', 'Could we reschedule?', 'reorder-feedback-reschedule-en-2')">Check Answer</button>
                            <div id="reorder-feedback-reschedule-en-2" class="feedback-message"></div>
                        </li>
                        <li>3. next / make / I / it / week / can.
                            <button class="play-audio-button" data-text="next make I it week can.">▶️ Play Audio</button>
                            <span id="reorder-reschedule-ex3-en-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-reschedule-en-3" class="reorder-input" placeholder="Your answer">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-reschedule-en-3', 'I can make it next week.', 'reorder-feedback-reschedule-en-3')">Check Answer</button>
                            <div id="reorder-feedback-reschedule-en-3" class="feedback-message"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Ask the AI: How would you decline and reschedule? 🤖</h5>
                    <p class="reorder-prompt">Practice declining a meeting and suggesting a new time. The AI will give you feedback.
                        <button class="play-audio-button" data-text="Practice declining a meeting and suggesting a new time. The AI will give you feedback.">▶️ Play Audio</button>
                        <span id="ai-reschedule-prompt-en-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <textarea id="ai-check-input-reschedule-en" class="ai-check-input" rows="3" placeholder="Example: I'm sorry, I can't make it today. Can we meet on Friday instead?"></textarea>
                    <button class="exercise-button" onclick="checkWithAI('ai-check-input-reschedule-en', 'ai-feedback-reschedule-en', 'How would you decline and reschedule a meeting?')">Check Answer</button>
                    <div id="ai-feedback-reschedule-en" class="ai-feedback-box"></div>
                </div>
            </div>
            <div class="content-pt hidden">
                <h2 class="section-title">
                    Lição 4: Reagendando uma Reunião 🗓️
                </h2>
                <div class="lesson-content">
                    <p class="lesson-intro" id="lesson4-intro-pt">
                        Primeiro, vamos esclarecer: <span class="highlight-text">meet</span> é um verbo (encontrar ou se reunir), e <span class="highlight-text">meeting</span> é um substantivo (uma assembleia ou reunião, ex: uma reunião de trabalho).
                        <button class="play-audio-button" data-text="Primeiro, vamos esclarecer: meet é um verbo, encontrar ou se reunir, e meeting é um substantivo, uma assembleia ou reunião, por exemplo, uma reunião de trabalho.">▶️ Reproduzir Áudio</button>
                        <span id="lesson4-intro-pt-spinner" class="loading-spinner hidden"></span>
                        <br><br>
                        Às vezes, você não pode comparecer a uma reunião. É importante saber como recusar educadamente e sugerir um novo horário.
                        <button class="play-audio-button" data-text="Às vezes, você não pode comparecer a uma reunião. É importante saber como recusar educadamente e sugerir um novo horário.">▶️ Reproduzir Áudio</button>
                        <span id="lesson4-intro-pt-part2-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <p><strong>Recusas Educadas:</strong></p>
                    <ul class="lesson-examples-list">
                        <li>👉 <span class="highlight-expression">Receio não poder comparecer.</span> (I'm afraid I can't make it.)
                            <button class="play-audio-button" data-text="Receio não poder comparecer.">▶️ Reproduzir Áudio</button>
                            <span id="decline1-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Lamento, não consigo ir.</span> (I'm sorry, I can't make it.)
                            <button class="play-audio-button" data-text="Lamento, não consigo ir.">▶️ Reproduzir Áudio</button>
                            <span id="decline2-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Não consigo ir.</span> (I can't make it.)
                            <button class="play-audio-button" data-text="Não consigo ir.">▶️ Reproduzir Áudio</button>
                            <span id="decline3-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                    </ul>

                    <!-- New Explanation Box for Polite Declines (Portuguese) -->
                    <div class="explanation-box fade-in">
                        <div class="lang-buttons">
                            <button class="lang-btn" data-lang="en" data-section="explanation-decline">English</button>
                            <button class="lang-btn active" data-lang="pt" data-section="explanation-decline">Português</button>
                        </div>
                        <div class="content-en hidden">
                            <h4>Understanding Polite Declines:</h4>
                            <p>
                                The phrase "I can't make it" is a direct and clear way to state your inability to attend. While concise, it can sound somewhat abrupt on its own, especially in formal or professional contexts.
                                <button class="play-audio-button" data-text="The phrase I can't make it is a direct and clear way to state your inability to attend. While concise, it can sound somewhat abrupt on its own, especially in formal or professional contexts.">▶️ Play Audio</button>
                                <span id="explain-decline-en-spinner1-new" class="loading-spinner hidden"></span>
                            </p>
                            <p>
                                To soften this directness and convey politeness, English speakers often add a preceding phrase:
                                <ul>
                                    <li>The phrase "<strong>I'm afraid</strong>" here is not about fear. Instead, it conveys a gentle sense of regret or reluctance to deliver news that might be disappointing. It softens the refusal, making it more empathetic and less abrupt. Think of it as a polite preamble to a negative statement.
                                        <button class="play-audio-button" data-text="The phrase I'm afraid here is not about fear. Instead, it conveys a gentle sense of regret or reluctance to deliver news that might be disappointing. It softens the refusal, making it more empathetic and less abrupt. Think of it as a polite preamble to a negative statement.">▶️ Play Audio</button>
                                        <span id="explain-decline-en-spinner2" class="loading-spinner hidden"></span>
                                    </li>
                                    <li>"<strong>I'm sorry</strong>" is a direct and clear apology for any inconvenience your absence may cause. It explicitly acknowledges the potential impact on the other person.
                                        <button class="play-audio-button" data-text="I'm sorry is a direct and clear apology for any inconvenience your absence may cause. It explicitly acknowledges the potential impact on the other person.">▶️ Play Audio</button>
                                        <span id="explain-decline-en-spinner3" class="loading-spinner hidden"></span>
                                    </li>
                                </ul>
                            </p>
                            <p>
                                Both "<strong>I'm afraid I can't make it</strong>" and "<strong>I'm sorry, I can't make it</strong>" are highly professional and demonstrate respect for the other person's time and plans, which is crucial in English business communication. They are always preferred over a simple "No" or "I can't go" when you want to maintain a polite and respectful tone.
                                <button class="play-audio-button" data-text="Both I'm afraid I can't make it and I'm sorry, I can't make it are highly professional and demonstrate respect for the other person's time and plans, which is crucial in English business communication. They are always preferred over a simple No or I can't go.">▶️ Play Audio</button>
                                <span id="explain-decline-en-spinner4" class="loading-spinner hidden"></span>
                            </p>
                        </div>
                        <div class="content-pt">
                            <h4>Entendendo as Recusas Educadas:</h4>
                            <p>
                                A frase "I can't make it" (Não consigo ir) é uma forma direta e clara de expressar sua incapacidade de comparecer. Embora concisa, ela pode soar um tanto abrupta por si só, especialmente em contextos formais ou profissionais.
                                <button class="play-audio-button" data-text="A frase I can't make it, Não consigo ir, é uma forma direta e clara de expressar sua incapacidade de comparecer. Embora concisa, ela pode soar um tanto abrupta por si só, especialmente em contextos formais ou profissionais.">▶️ Reproduzir Áudio</button>
                                <span id="explain-decline-pt-spinner1-new" class="loading-spinner hidden"></span>
                            </p>
                            <p>
                                Para suavizar essa franqueza e transmitir polidez, falantes de inglês frequentemente adicionam uma frase anterior:
                                <ul>
                                    <li>A expressão "<strong>I'm afraid</strong>" (Receio) aqui não se refere a ter medo. Em vez disso, ela transmite um **sentimento de lamento ou relutância** ao dar uma notícia que pode ser decepcionante. Ela suaviza a recusa, tornando-a mais empática e menos direta. Pense nela como um preâmbulo educado para uma afirmação negativa.
                                        <button class="play-audio-button" data-text="A expressão I'm afraid, Receio, aqui não se refere a ter medo. Em vez disso, ela transmite um sentimento de lamento ou relutância ao dar uma notícia que pode ser decepcionante. Ela suaviza a recusa, tornando-a mais empática e menos direta. Pense nela como um preâmbulo educado para uma afirmação negativa.">▶️ Reproduzir Áudio</button>
                                        <span id="explain-decline-pt-spinner2" class="loading-spinner hidden"></span>
                                    </li>
                                    <li>"<strong>I'm sorry</strong>" (Lamento/Sinto muito) é um pedido de desculpas direto e claro por qualquer inconveniente que sua ausência possa causar. Ele reconhece explicitamente o impacto potencial na outra pessoa.
                                        <button class="play-audio-button" data-text="I'm sorry, Lamento, Sinto muito, é um pedido de desculpas direto e claro por qualquer inconveniente que sua ausência possa causar. Ele reconhece explicitamente o impacto potencial na outra pessoa.">▶️ Reproduzir Áudio</button>
                                        <span id="explain-decline-pt-spinner3" class="loading-spinner hidden"></span>
                                    </li>
                                </ul>
                            </p>
                            <p>
                                Tanto "<strong>I'm afraid I can't make it</strong>" quanto "<strong>I'm sorry, I can't make it</strong>" são **altamente profissionais** e demonstram respeito pelo tempo e pelos planos da outra pessoa, o que é crucial na comunicação empresarial em inglês. Elas são sempre preferíveis a um simples "Não" ou "Não posso ir" quando você deseja manter um tom educado e respeitoso.
                                <button class="play-audio-button" data-text="Tanto I'm afraid I can't make it quanto I'm sorry, I can't make it são altamente profissionais e demonstram respeito pelo tempo e pelos planos da outra pessoa, o que é crucial na comunicação empresarial em inglês. Elas são sempre preferíveis a um simples Não ou Não posso ir quando você deseja manter um tom educado e respeitoso.">▶️ Reproduzir Áudio</button>
                                <span id="explain-decline-pt-spinner4" class="loading-spinner hidden"></span>
                            </p>
                        </div>
                    </div>

                    <p class="lesson-note">
                        Você pode continuar com um breve <span class="highlight-text">motivo</span>, se for apropriado.
                        <button class="play-audio-button" data-text="Você pode continuar com um breve motivo, se for apropriado.">▶️ Reproduzir Áudio</button>
                        <span id="decline-note-pt-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <p class="lesson-examples-title">Exemplos com Motivo:</p>
                    <ul class="lesson-examples-list">
                        <li>👉 <span class="highlight-expression">Receio não poder comparecer. O motivo é que tenho outro compromisso.</span>
                            <button class="play-audio-button" data-text="Receio não poder comparecer. O motivo é que tenho outro compromisso.">▶️ Reproduzir Áudio</button>
                            <span id="decline-reason1-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Lamento, não consigo ir. Tenho um compromisso anterior.</span>
                            <button class="play-audio-button" data-text="Lamento, não consigo ir. Tenho um compromisso anterior.">▶️ Reproduzir Áudio</button>
                            <span id="decline-reason2-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                    </ul>

                    <p><strong>Sugerindo um Reagendamento:</strong></p>
                    <ul class="lesson-examples-list">
                        <li>👉 <span class="highlight-expression">Podemos deixar para outra hora?</span> (May I take a rain check?)
                            <button class="play-audio-button" data-text="Podemos deixar para outra hora?">▶️ Reproduzir Áudio</button>
                            <span id="reschedule1-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Poderíamos reagendar?</span> (Could we reschedule?)
                            <button class="play-audio-button" data-text="Poderíamos reagendar?">▶️ Reproduzir Áudio</button>
                            <span id="reschedule2-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                    </ul>
                    <p class="lesson-note">
                        Quando você <span class="highlight-text">pode comparecer</span>, é bom <span class="highlight-text">sugerir um horário e dia diferentes</span>.
                        <button class="play-audio-button" data-text="Quando você pode comparecer, é bom sugerir um horário e dia diferentes.">▶️ Reproduzir Áudio</button>
                        <span id="reschedule-note-pt-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <p class="lesson-examples-title">Exemplos de Sugerir Novos Horários:</p>
                    <ul class="lesson-examples-list">
                        <li>👉 <span class="highlight-expression">Posso ir na terça-feira à tarde.</span>
                            <button class="play-audio-button" data-text="Posso ir na terça-feira à tarde.">▶️ Reproduzir Áudio</button>
                            <span id="reschedule-time1-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Poderíamos reagendar para a próxima segunda-feira?</span>
                            <button class="play-audio-button" data-text="Poderíamos reagendar para a próxima segunda-feira?">▶️ Reproduzir Áudio</button>
                            <span id="reschedule-time2-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                        <li>👉 <span class="highlight-expression">Lamento, não consigo ir hoje. Que tal nos encontrarmos amanhã às 10h?</span>
                            <button class="play-audio-button" data-text="Lamento, não consigo ir hoje. Que tal nos encontrarmos amanhã às 10h?">▶️ Reproduzir Áudio</button>
                            <span id="reschedule-time3-pt-spinner" class="loading-spinner hidden"></span>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Traduza estas frases: 🗣️</h5>
                    <ul class="translation-list">
                        <li><strong>Português:</strong> Lamento, não consigo ir.
                            <button class="play-audio-button" data-text="Lamento, não consigo ir.">▶️ Reproduzir Áudio</button>
                            <span id="translate-reschedule-pt-1-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-reschedule-pt-1" class="translation-input" rows="1" placeholder="Sua tradução para o inglês"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-reschedule-pt-1', 'translate-feedback-reschedule-pt-1', 'Lamento, não consigo ir.', 'pt')">Check Answer</button>
                            <div id="translate-feedback-reschedule-pt-1" class="ai-feedback-box"></div>
                        </li>
                        <li><strong>Português:</strong> Podemos deixar para outra hora?
                            <button class="play-audio-button" data-text="Podemos deixar para outra hora?">▶️ Reproduzir Áudio</button>
                            <span id="translate-reschedule-pt-2-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-reschedule-pt-2" class="translation-input" rows="1" placeholder="Sua tradução para o inglês"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-reschedule-pt-2', 'translate-feedback-reschedule-pt-2', 'Podemos deixar para outra hora?', 'pt')">Check Answer</button>
                            <div id="translate-feedback-reschedule-pt-2" class="ai-feedback-box"></div>
                        </li>
                        <li><strong>Português:</strong> Eu posso ir na quinta-feira de manhã.
                            <button class="play-audio-button" data-text="Eu posso ir na quinta-feira de manhã.">▶️ Reproduzir Áudio</button>
                            <span id="translate-reschedule-pt-3-spinner" class="loading-spinner hidden"></span>
                            <textarea id="translate-input-reschedule-pt-3" class="translation-input" rows="1" placeholder="Sua tradução para o inglês"></textarea>
                            <button class="exercise-button" onclick="checkTranslationWithAI('translate-input-reschedule-pt-3', 'translate-feedback-reschedule-pt-3', 'Eu posso ir na quinta-feira de manhã.', 'pt')">Check Answer</button>
                            <div id="translate-feedback-reschedule-pt-3" class="ai-feedback-box"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Exercício: Reordene as palavras! 🧩</h5>
                    <p class="reorder-prompt">Digite a frase correta:
                        <button class="play-audio-button" data-text="Digite a frase correta.">▶️ Reproduzir Áudio</button>
                        <span id="reorder-reschedule-prompt-pt-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <ul class="reorder-exercise-list">
                        <li>1. ir / consigo / Lamento, / não.
                            <button class="play-audio-button" data-text="ir consigo Lamento, não.">▶️ Reproduzir Áudio</button>
                            <span id="reorder-reschedule-ex1-pt-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-reschedule-pt-1" class="reorder-input" placeholder="Sua resposta">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-reschedule-pt-1', 'Lamento, não consigo ir.', 'reorder-feedback-reschedule-pt-1')">Check Answer</button>
                            <div id="reorder-feedback-reschedule-pt-1" class="feedback-message"></div>
                        </li>
                        <li>2. reagendar / Poderíamos?
                            <button class="play-audio-button" data-text="reagendar Poderíamos?">▶️ Reproduzir Áudio</button>
                            <span id="reorder-reschedule-ex2-pt-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-reschedule-pt-2" class="reorder-input" placeholder="Sua resposta">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-reschedule-pt-2', 'Poderíamos reagendar?', 'reorder-feedback-reschedule-pt-2')">Check Answer</button>
                            <div id="reorder-feedback-reschedule-pt-2" class="feedback-message"></div>
                        </li>
                        <li>3. próxima / posso / ir / Eu / semana.
                            <button class="play-audio-button" data-text="próxima posso ir Eu semana.">▶️ Reproduzir Áudio</button>
                            <span id="reorder-reschedule-ex3-pt-spinner" class="loading-spinner hidden"></span>
                            <input type="text" id="reorder-input-reschedule-pt-3" class="reorder-input" placeholder="Sua resposta">
                            <button class="exercise-button" onclick="checkReorder('reorder-input-reschedule-pt-3', 'Eu posso ir na próxima semana.', 'reorder-feedback-reschedule-pt-3')">Check Answer</button>
                            <div id="reorder-feedback-reschedule-pt-3" class="feedback-message"></div>
                        </li>
                    </ul>

                    <h5 class="lesson-section-subtitle">Pergunte à IA: Como você recusaria e reagendaria? 🤖</h5>
                    <p class="reorder-prompt">Pratique recusar uma reunião e sugerir um novo horário. A IA lhe dará feedback.
                        <button class="play-audio-button" data-text="Pratique recusar uma reunião e sugerir um novo horário. A IA lhe dará feedback.">▶️ Reproduzir Áudio</button>
                        <span id="ai-reschedule-prompt-pt-spinner" class="loading-spinner hidden"></span>
                    </p>
                    <textarea id="ai-check-input-reschedule-pt" class="ai-check-input" rows="3" placeholder="Exemplo: Lamento, não consigo ir hoje. Podemos nos encontrar na sexta-feira?"></textarea>
                    <button class="exercise-button" onclick="checkWithAI('ai-check-input-reschedule-pt', 'ai-feedback-reschedule-pt', 'Como você recusaria e reagendaria uma reunião?')">Check Answer</button>
                    <div id="ai-feedback-reschedule-pt" class="ai-feedback-box"></div>
                </div>
            </div>
        </section>

        <!-- Section 2: Quick References (now Section 5 visually) -->
        <section id="section-references" class="content-card">
            <div class="lang-buttons">
                <button class="lang-btn active" data-lang="en" data-section="section-references">English</button>
                <button class="lang-btn" data-lang="pt" data-section="section-references">Português</button>
            </div>
            <div class="content-en quick-references">
                <h2 class="section-title">Quick References: Common Phrases</h2>
                <ul>
                    <li><span class="highlight-expression">"How's it going?"</span> - A casual greeting.
                        <button class="play-audio-button" data-text="How's it going? A casual greeting.">▶️ Play Audio</button>
                        <span id="ref1-en-spinner" class="loading-spinner hidden"></span>
                    </li>
                    <li><span class="highlight-expression">"No worries!"</span> - Used to say "It's okay" or "Don't apologize."
                        <button class="play-audio-button" data-text="No worries! Used to say It's okay or Don't apologize.">▶️ Play Audio</button>
                        <span id="ref2-en-spinner" class="loading-spinner hidden"></span>
                    </li>
                    <li><span class="highlight-expression">"Long story short..."</span> - To summarize a lengthy explanation.
                        <button class="play-audio-button" data-text="Long story short... To summarize a lengthy explanation.">▶️ Play Audio</button>
                        <span id="ref3-en-spinner" class="loading-spinner hidden"></span>
                    </li>
                    <li><span class="highlight-expression">"Hit the road!"</span> - To leave a place.
                        <button class="play-audio-button" data-text="Hit the road! To leave a place.">▶️ Play Audio</button>
                        <span id="ref4-en-spinner" class="loading-spinner hidden"></span>
                    </li>
                </ul>
            </div>
            <div class="content-pt quick-references hidden">
                <h2 class="section-title">Referências Rápidas: Frases Comuns</h2>
                <ul>
                    <li><span class="highlight-expression">"Como vai?"</span> - Uma saudação casual.
                        <button class="play-audio-button" data-text="Como vai? Uma saudação casual.">▶️ Reproduzir Áudio</button>
                        <span id="ref1-pt-spinner" class="loading-spinner hidden"></span>
                    </li>
                    <li><span class="highlight-expression">"Sem problemas!"</span> - Usado para dizer "Está tudo bem" ou "Não se desculpe."
                        <button class="play-audio-button" data-text="Sem problemas! Usado para dizer Está tudo bem ou Não se desculpe.">▶️ Reproduzir Áudio</button>
                        <span id="ref2-pt-spinner" class="loading-spinner hidden"></span>
                    </li>
                    <li><span class="highlight-expression">"Resumindo..."</span> - Para resumir uma explicação longa.
                        <button class="play-audio-button" data-text="Resumindo... Para resumir uma explicação longa.">▶️ Reproduzir Áudio</button>
                        <span id="ref3-pt-spinner" class="loading-spinner hidden"></span>
                    </li>
                    <li><span class="highlight-expression">"Cair na estrada!"</span> - Para sair de um lugar.
                        <button class="play-audio-button" data-text="Cair na estrada! Para sair de um lugar.">▶️ Reproduzir Áudio</button>
                        <span id="ref4-pt-spinner" class="loading-spinner hidden"></span>
                    </li>
                </ul>
            </div>
        </section>

        <!-- Section 3: Conversation Starters (now Section 6 visually) -->
        <section id="section-conversation" class="content-card">
            <div class="lang-buttons">
                <button class="lang-btn active" data-lang="en" data-section="section-conversation">English</button>
                <button class="lang-btn" data-lang="pt" data-section="section-conversation">Português</button>
            </div>
            <div class="content-en conversation-type-box">
                <h2 class="section-title">Starting a Conversation</h2>
                <h4>Key Phrases:</h4>
                <ul>
                    <li>"Hi, how are you doing today?"
                        <button class="play-audio-button" data-text="Hi, how are you doing today?">▶️ Play Audio</button>
                        <span id="conv1-en-spinner" class="loading-spinner hidden"></span>
                    </li>
                    <li>"What have you been up to lately?"
                        <button class="play-audio-button" data-text="What have you been up to lately?">▶️ Play Audio</button>
                        <span id="conv2-en-spinner" class="loading-spinner hidden"></span>
                    </li>
                    <li>"Lovely weather, isn't it?"
                        <button class="play-audio-button" data-text="Lovely weather, isn't it?">▶️ Play Audio</button>
                        <span id="conv3-en-spinner" class="loading-spinner hidden"></span>
                    </li>
                    <li>"Excuse me, could you tell me...?"
                        <button class="play-audio-button" data-text="Excuse me, could you tell me...?">▶️ Play Audio</button>
                        <span id="conv4-en-spinner" class="loading-spinner hidden"></span>
                    </li>
                </ul>
                <p class="content-text">
                    Practice these phrases to feel more confident in your daily interactions.
                    Remember, the key is to <span class="highlight-expression">start small</span> and build up your confidence!
                    <button class="play-audio-button" data-text="Practice these phrases to feel more confident in your daily interactions. Remember, the key is to start small and build up your confidence!">▶️ Play Audio</button>
                    <span id="conv-note-en-spinner" class="loading-spinner hidden"></span>
                </p>
            </div>
            <div class="content-pt conversation-type-box hidden">
                <h2 class="section-title">Iniciando uma Conversa</h2>
                <h4>Frases Chave:</h4>
                <ul>
                    <li>"Oi, como você está hoje?"
                        <button class="play-audio-button" data-text="Oi, como você está hoje?">▶️ Reproduzir Áudio</button>
                        <span id="conv1-pt-spinner" class="loading-spinner hidden"></span>
                    </li>
                    <li>"O que você tem feito ultimamente?"
                        <button class="play-audio-button" data-text="O que você tem feito ultimamente?">▶️ Reproduzir Áudio</button>
                        <span id="conv2-pt-spinner" class="loading-spinner hidden"></span>
                    </li>
                    <li>"Tempo agradável, não é?"
                        <button class="play-audio-button" data-text="Tempo agradável, não é?">▶️ Reproduzir Áudio</button>
                        <span id="conv3-pt-spinner" class="loading-spinner hidden"></span>
                    </li>
                    <li>"Com licença, você poderia me dizer...?"
                        <button class="play-audio-button" data-text="Com licença, você poderia me dizer...?">▶️ Reproduzir Áudio</button>
                        <span id="conv4-pt-spinner" class="loading-spinner hidden"></span>
                    </li>
                </ul>
                <p class="content-text">
                    Pratique estas frases para se sentir mais confiante em suas interações diárias.
                    Lembre-se, o segredo é <span class="highlight-expression">começar pequeno</span> e construir sua confiança!
                    <button class="play-audio-button" data-text="Pratique estas frases para se sentir mais confiante em suas interações diárias. Lembre-se, o segredo é começar pequeno e construir sua confiança!">▶️ Reproduzir Áudio</button>
                    <span id="conv-note-pt-spinner" class="loading-spinner hidden"></span>
                </p>
            </div>
        </section>

        <!-- Section 4: Interactive Exercise - Fill in the Blank (now Section 7 visually) -->
        <section id="section-exercise1" class="content-card">
            <div class="lang-buttons">
                <button class="lang-btn active" data-lang="en" data-section="section-exercise1">English</button>
                <button class="lang-btn" data-lang="pt" data-section="section-exercise1">Português</button>
            </div>
            <div class="content-en exercise-container">
                <h2 class="section-title">Exercise 1: Fill in the Blank</h2>
                <h3>Complete the sentence:</h3>
                <p class="exercise-prompt">
                    She is a great teacher, she always ______ us new things.
                    <button class="play-audio-button" data-text="She is a great teacher, she always teaches us new things.">▶️ Play Audio</button>
                    <span id="exercise1-en-spinner" class="loading-spinner hidden"></span>
                    <input type="text" id="exercise1-input-en" class="exercise-input" placeholder="Your answer">
                    <button class="exercise-button" onclick="checkAnswer('section-exercise1', 'exercise1-input-en', 'exercise1-feedback-en', 'teaches')">Check Answer</button>
                </p>
                <div id="exercise1-feedback-en" class="feedback-message"></div>
                <p class="content-text text-sm mt-4">
                    <span class="font-bold">Note:</span> Audio is generated via Text-to-Speech API.
                </p>
            </div>
            <div class="content-pt exercise-container hidden">
                <h2 class="section-title">Exercício 1: Preencha a Lacuna</h2>
                <h3>Complete a frase:</h3>
                <p class="exercise-prompt">
                    Ela é uma ótima professora, ela sempre ______ coisas novas para nós.
                    <button class="play-audio-button" data-text="Ela é uma ótima professora, ela sempre ensina coisas novas para nós.">▶️ Reproduzir Áudio</button>
                    <span id="exercise1-pt-spinner" class="loading-spinner hidden"></span>
                    <input type="text" id="exercise1-input-pt" class="exercise-input" placeholder="Sua resposta">
                    <button class="exercise-button" onclick="checkAnswer('section-exercise1', 'exercise1-input-pt', 'exercise1-feedback-pt', 'ensina')">Check Answer</button>
                </p>
                <div id="exercise1-feedback-pt" class="feedback-message"></div>
                <p class="content-text text-sm mt-4">
                    <span class="font-bold">Nota:</span> O áudio é gerado via API de Text-to-Speech.
                </p>
            </div>
        </section>

    </main>

    <!-- Footer Section -->
    <footer>
        <p>&copy; 2025 DABY METHOD by Teacher Daby. All rights reserved.</p>
    </footer>

    <!-- html2pdf.js library for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script>
        // --- JavaScript for Interactive Functionality ---

        // 1. Language Switching Logic
        document.querySelectorAll('.lang-buttons button').forEach(button => {
            button.addEventListener('click', function() {
                const sectionId = this.dataset.section;
                const lang = this.dataset.lang;
                const section = document.getElementById(sectionId);

                // Remove 'active' from all buttons in this section's lang-buttons
                section.querySelectorAll('.lang-buttons button').forEach(btn => btn.classList.remove('active'));
                // Add 'active' to the clicked button
                this.classList.add('active');

                // Hide all language content divs and show the selected one
                section.querySelectorAll('.content-en, .content-pt').forEach(contentDiv => {
                    contentDiv.classList.add('hidden');
                });
                section.querySelector(`.content-${lang}`).classList.remove('hidden');
            });
        });

        // 2. "Hi, there!" Effect Box Logic (for Lesson 1)
        const hiThereWordsEn = ["Hello!", "Welcome!", "Great to see you!", "Let's learn!", "DABY METHOD!"];
        const hiThereWordsPt = ["Olá!", "Bem-vindo(a)!", "Que bom te ver!", "Vamos aprender!", "MÉTODO DABY!"];
        let currentWordIndexEn = 0;
        let currentWordIndexPt = 0;
        let hiThereIntervalEn;
        let hiThereIntervalPt;

        function updateHiThereWord(elementId, wordsArray, indexVar) {
            const wordElement = document.getElementById(elementId);
            if (!wordElement) return;

            wordElement.classList.remove('active');
            setTimeout(() => {
                wordElement.textContent = wordsArray[indexVar];
                wordElement.classList.add('active');
            }, 500);
        }

        function startHiThereAnimation(elementId, wordsArray, indexVar, intervalVarName) {
            if (window[intervalVarName]) {
                clearInterval(window[intervalVarName]);
            }
            updateHiThereWord(elementId, wordsArray, window[indexVar]);
            window[intervalVarName] = setInterval(() => {
                window[indexVar] = (window[indexVar] + 1) % wordsArray.length;
                updateHiThereWord(elementId, wordsArray, window[indexVar]);
            }, 3000);
        }

        // 3. Content Card Fade-in on Scroll Logic
        const contentCards = document.querySelectorAll('.content-card');

        const observerOptions = {
            root: null, // Use the viewport as the root
            rootMargin: '0px',
            threshold: 0.1 // Trigger when 10% of the item is visible
        };

        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('fade-in');
                    observer.unobserve(entry.target); // Stop observing once it's faded in
                }
            });
        }, observerOptions);

        contentCards.forEach(card => {
            observer.observe(card);
        });

        // 4. Interactive Exercise Logic (Fill in the Blank and Preposition Exercise)
        function checkAnswer(sectionId, inputId, feedbackId, correctAnswer) {
            const inputElement = document.getElementById(inputId);
            const feedbackElement = document.getElementById(feedbackId);
            const userAnswer = inputElement.value.trim().toLowerCase(); // Get value, trim whitespace, convert to lowercase

            // Clear previous feedback classes
            feedbackElement.classList.remove('correct', 'incorrect');

            if (userAnswer === correctAnswer.toLowerCase()) {
                feedbackElement.textContent = 'Correct! Great job!';
                feedbackElement.classList.add('correct');
            } else {
                feedbackElement.textContent = `Incorrect. The correct answer is "${correctAnswer}".`;
                feedbackElement.classList.add('incorrect');
            }
        }

        // Reorder Exercise Logic
        function checkReorder(inputId, correctAnswer, feedbackId) {
            const inputElement = document.getElementById(inputId);
            const feedbackElement = document.getElementById(feedbackId);
            const userAnswer = inputElement.value.trim().replace(/\s+/g, ' ').toLowerCase(); // Normalize whitespace

            // Clear previous feedback classes
            feedbackElement.classList.remove('correct', 'incorrect');

            if (userAnswer === correctAnswer.toLowerCase()) {
                feedbackElement.textContent = 'Correct! Well done!';
                feedbackElement.classList.add('correct');
            } else {
                feedbackElement.textContent = `Incorrect. Try again! The correct sentence is "${correctAnswer}".`;
                feedbackElement.classList.add('incorrect');
            }
        }

        // Helper functions for TTS audio playback
        function base64ToArrayBuffer(base64) {
            const binaryString = atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        function pcmToWav(pcm16, sampleRate) {
            const numChannels = 1;
            const bytesPerSample = 2; // 16-bit PCM
            const blockAlign = numChannels * bytesPerSample;
            const byteRate = sampleRate * blockAlign;

            const wavBuffer = new ArrayBuffer(44 + pcm16.length * bytesPerSample);
            const view = new DataView(wavBuffer);

            // RIFF chunk descriptor
            writeString(view, 0, 'RIFF');
            view.setUint32(4, 36 + pcm16.length * bytesPerSample, true); // Total file size - 8
            writeString(view, 8, 'WAVE');

            // FMT sub-chunk
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true); // Sub-chunk size
            view.setUint16(20, 1, true); // Audio format (1 = PCM)
            view.setUint16(22, numChannels, true); // Number of channels
            view.setUint32(24, sampleRate, true); // Sample rate
            view.setUint32(28, byteRate, true); // Byte rate
            view.setUint16(32, blockAlign, true); // Block align
            view.setUint16(34, 16, true); // Bits per sample

            // DATA sub-chunk
            writeString(view, 36, 'data');
            view.setUint32(40, pcm16.length * bytesPerSample, true); // Data size

            // Write PCM data
            for (let i = 0; i < pcm16.length; i++) {
                view.setInt16(44 + i * bytesPerSample, pcm16[i], true);
            }

            return new Blob([view], { type: 'audio/wav' });
        }

        function writeString(view, offset, string) {
            for (let i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        }

        // Play audio for any text using TTS
        document.querySelectorAll('.play-audio-button').forEach(button => {
            button.addEventListener('click', async function() {
                const audioText = this.dataset.text;
                const spinner = this.nextElementSibling; // Assuming spinner is the next sibling span

                if (!audioText) {
                    console.warn("No text found for audio playback.");
                    return;
                }

                // Show loading spinner
                if (spinner && spinner.classList.contains('loading-spinner')) spinner.classList.remove('hidden');
                this.disabled = true; // Disable button during playback

                let retries = 0;
                const maxRetries = 3;
                const baseDelay = 1000; // 1 second

                while (retries < maxRetries) {
                    try {
                        const payload = {
                            contents: [{
                                parts: [{ text: audioText }]
                            }],
                            generationConfig: {
                                responseModalities: ["AUDIO"],
                                speechConfig: {
                                    voiceConfig: {
                                        prebuiltVoiceConfig: { voiceName: "Kore" } // Using Kore voice
                                    }
                                }
                            },
                            model: "gemini-2.5-flash-preview-tts"
                        };
                        const apiKey = ""; // Canvas will automatically provide the API key
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            if (response.status === 429) {
                                const delay = baseDelay * Math.pow(2, retries);
                                console.warn(`Rate limit hit. Retrying in ${delay / 1000}s...`);
                                await new Promise(res => setTimeout(res, delay));
                                retries++;
                                continue;
                            } else if (response.status === 401) {
                                console.error("Authentication error (401). Please check your API key configuration.");
                                // Display a user-friendly message on the UI if possible
                                const feedbackElement = spinner.nextElementSibling; // Assuming feedback element is after spinner
                                if (feedbackElement && feedbackElement.classList.contains('feedback-message')) {
                                    feedbackElement.textContent = "Authentication failed. Please ensure your API key is correctly configured for TTS.";
                                    feedbackElement.classList.add('incorrect');
                                }
                                break; // Do not retry on 401
                            } else {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                        }

                        const result = await response.json();
                        const part = result?.candidates?.[0]?.content?.parts?.[0];
                        const audioData = part?.inlineData?.data;
                        const mimeType = part?.inlineData?.mimeType;

                        if (audioData && mimeType && mimeType.startsWith("audio/")) {
                            const sampleRateMatch = mimeType.match(/rate=(\d+)/);
                            const sampleRate = sampleRateMatch ? parseInt(sampleRateMatch[1], 10) : 16000; // Default to 16kHz if not found

                            const pcmData = base64ToArrayBuffer(audioData);
                            const pcm16 = new Int16Array(pcmData);
                            const wavBlob = pcmToWav(pcm16, sampleRate);
                            const audioUrl = URL.createObjectURL(wavBlob);

                            const audio = new Audio(audioUrl);
                            audio.play().catch(e => console.error("Error playing generated audio:", e));
                            audio.onended = () => {
                                URL.revokeObjectURL(audioUrl); // Clean up the URL after playback
                                if (spinner) spinner.classList.add('hidden');
                                this.disabled = false; // Re-enable button
                            };
                        } else {
                            console.error("Invalid audio data or mime type from API:", result);
                            if (spinner) spinner.classList.add('hidden');
                            this.disabled = false; // Re-enable button
                        }
                        return; // Exit loop on success
                    } catch (error) {
                        console.error("Error generating or playing TTS audio:", error);
                        if (spinner) spinner.classList.add('hidden');
                        this.disabled = false; // Re-enable button
                        break; // Exit loop on unrecoverable error
                    }
                }

                if (retries === maxRetries) {
                    console.error("Failed to generate TTS audio after multiple retries.");
                    if (spinner) spinner.classList.add('hidden');
                    this.disabled = false; // Re-enable button
                }
            });
        });


        // AI Check Answers Logic for 'Where do you work?', 'What department do you work in?', and 'Do you work from home or in-person?'
        async function checkWithAI(inputId, feedbackId, questionPrompt) {
            const inputElement = document.getElementById(inputId);
            const feedbackElement = document.getElementById(feedbackId);
            const userAnswer = inputElement.value.trim();

            if (!userAnswer) {
                feedbackElement.textContent = "Please type something before checking with AI.";
                feedbackElement.classList.remove('correct', 'incorrect');
                return;
            }

            feedbackElement.innerHTML = '<span class="loading-spinner"></span> Checking with AI...';
            feedbackElement.classList.remove('correct', 'incorrect'); // Clear previous feedback

            let chatHistory = [];
            const prompt = `You are an English language tutor. A student was asked '${questionPrompt}' and they responded: '${userAnswer}'. Provide constructive feedback on their answer. Focus on grammatical correctness, natural phrasing, and appropriate prepositions (like 'at', 'in', 'for', 'from home', 'in-person'). If the answer is correct or perfectly natural, praise them. If there are errors, gently correct them and explain why. Keep your feedback concise and encouraging.`;
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });

            const payload = { contents: chatHistory };
            const apiKey = ""; // Canvas will automatically provide the API key
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            let retries = 0;
            const maxRetries = 3;
            const baseDelay = 1000; // 1 second

            while (retries < maxRetries) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        // Handle HTTP errors
                        if (response.status === 429) { // Too many requests
                            const delay = baseDelay * Math.pow(2, retries);
                            console.warn(`Rate limit hit. Retrying in ${delay / 1000}s...`);
                            await new Promise(res => setTimeout(res, delay));
                            retries++;
                            continue; // Retry the request
                        } else {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                    }

                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        feedbackElement.textContent = text;
                        // No specific 'correct' or 'incorrect' class from AI, just display feedback
                    } else {
                        feedbackElement.textContent = "Sorry, I couldn't get feedback from the AI. Please try again.";
                        console.error("Unexpected AI response structure:", result);
                    }
                    return; // Exit loop on success
                } catch (error) {
                    console.error("Error checking with AI:", error);
                    feedbackElement.textContent = "An error occurred while connecting to the AI. Please try again later.";
                    break; // Exit loop on unrecoverable error
                }
            }

            if (retries === maxRetries) {
                feedbackElement.textContent = "Failed to get a response from AI after multiple retries. Please try again later.";
            }
        }

        // AI Check Answers Logic for Translation Exercise
        async function checkTranslationWithAI(inputId, feedbackId, portugueseSentence, lang) {
            const inputElement = document.getElementById(inputId);
            const feedbackElement = document.getElementById(feedbackId);
            const userAnswer = inputElement.value.trim();

            if (!userAnswer) {
                feedbackElement.textContent = "Please type your translation before checking with AI.";
                feedbackElement.classList.remove('correct', 'incorrect');
                return;
            }

            feedbackElement.innerHTML = '<span class="loading-spinner"></span> Checking translation with AI...';
            feedbackElement.classList.remove('correct', 'incorrect'); // Clear previous feedback

            let chatHistory = [];
            let prompt;
            if (lang === 'en') {
                prompt = `You are an English language tutor. A student provided the English translation '${userAnswer}' for the Portuguese sentence '${portugueseSentence}'. Evaluate their translation. Provide constructive feedback focusing on grammatical correctness, natural phrasing, and the correct use of prepositions, especially for locations where one 'works at' or 'works in'. If the translation is perfect, praise them. If there are errors, gently correct them and explain why. Keep your feedback concise and encouraging.`;
            } else { // lang === 'pt'
                // For Portuguese side, the user is still translating *to* English, but the prompt is in Portuguese.
                prompt = `Você é um tutor de inglês. Um aluno forneceu a tradução em inglês '${userAnswer}' para a frase em português '${portugueseSentence}'. Avalie a tradução. Forneça feedback construtivo focando na correção gramatical, fluidez natural e uso correto de preposições, especialmente para locais onde se 'trabalha em/na', 'trabalha de casa' ou 'trabalha presencialmente'. Se a tradução estiver perfeita, elogie-o. Se houver erros, corrija-os gentilmente e explique o porquê. Mantenha seu feedback conciso e encorajador.`;
            }

            chatHistory.push({ role: "user", parts: [{ text: prompt }] });

            const payload = { contents: chatHistory };
            const apiKey = ""; // Canvas will automatically provide the API key
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            let retries = 0;
            const maxRetries = 3;
            const baseDelay = 1000; // 1 second

            while (retries < maxRetries) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429) {
                            const delay = baseDelay * Math.pow(2, retries);
                            console.warn(`Rate limit hit. Retrying in ${delay / 1000}s...`);
                            await new Promise(res => setTimeout(res, delay));
                            retries++;
                            continue;
                        } else {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                    }

                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        feedbackElement.textContent = text;
                    } else {
                        feedbackElement.textContent = "Sorry, I couldn't get feedback from the AI. Please try again.";
                        console.error("Unexpected AI response structure:", result);
                    }
                    return;
                } catch (error) {
                    console.error("Error checking with AI:", error);
                    feedbackElement.textContent = "An error occurred while connecting to the AI. Please try again later.";
                    break;
                }
            }

            if (retries === maxRetries) {
                feedbackElement.textContent = "Failed to get a response from AI after multiple retries. Please try again later.";
            }
        }

        // Initialize animations and event listeners on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Note: hiThereWord and hiThereWordPt elements are not present in the current HTML.
            // The animation functions `startHiThereAnimation` are designed to work if these elements exist.
            // If they are meant to be part of a future "Hi, there!" section, they will function then.
            // For now, these calls might not find the elements, but won't cause errors due to the `if (!wordElement) return;` check.

            // startHiThereAnimation('hiThereWord', hiThereWordsEn, 'currentWordIndexEn', 'hiThereIntervalEn');
            // startHiThereAnimation('hiThereWordPt', hiThereWordsPt, 'currentWordIndexPt', 'hiThereIntervalPt');

            // Explanation toggle logic for "Hi, there!" effect buttons (for Lesson 1)
            const toggleHiThereButton = document.getElementById('toggleHiThere');
            if (toggleHiThereButton) {
                toggleHiThereButton.addEventListener('click', () => {
                    const explanationDiv = document.getElementById('hiThereExplanationEn');
                    explanationDiv.classList.toggle('active');
                    if (explanationDiv.classList.contains('active')) {
                        clearInterval(hiThereIntervalEn);
                    } else {
                        // startHiThereAnimation('hiThereWord', hiThereWordsEn, 'currentWordIndexEn', 'hiThereIntervalEn');
                    }
                });
            }

            const toggleHiTherePtButton = document.getElementById('toggleHiTherePt');
            if (toggleHiTherePtButton) {
                toggleHiTherePtButton.addEventListener('click', () => {
                    const explanationDiv = document.getElementById('hiThereExplanationPt');
                    explanationDiv.classList.toggle('active');
                    if (explanationDiv.classList.contains('active')) {
                        clearInterval(hiThereIntervalPt);
                    } else {
                        // startHiThereAnimation('hiThereWordPt', hiThereWordsPt, 'currentWordIndexPt', 'hiThereIntervalPt');
                    }
                });
            }

            // PDF Export Functionality
            const exportPdfBtn = document.getElementById('exportPdfBtn');
            if (exportPdfBtn) {
                exportPdfBtn.addEventListener('click', function() {
                    const element = document.querySelector('.content-container'); // Select the main content area to export

                    // Configure PDF options for better output
                    const opt = {
                        margin: 1,
                        filename: 'DABY_METHOD_Lesson.pdf',
                        image: { type: 'jpeg', quality: 0.98 },
                        html2canvas: { scale: 2, logging: true, dpi: 192, letterRendering: true },
                        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
                    };

                    // Use html2pdf to generate and save the PDF
                    html2pdf().set(opt).from(element).save();
                });
            }
        });
    </script>
</body>
</html>
